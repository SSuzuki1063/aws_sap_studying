<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS CloudFormation テンプレート作成ガイド</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            background: linear-gradient(135deg, #232f3e 0%, #0d1218 100%);
            color: white;
            border-radius: 10px 10px 0 0;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2em;
            font-weight: 300;
            margin-bottom: 20px;
        }
        
        .intro {
            background-color: white;
            padding: 25px;
            border-radius: 0 0 10px 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .section {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h2 {
            color: #232f3e;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ff9900;
        }
        
        h3 {
            color: #232f3e;
            font-size: 1.4em;
            margin: 20px 0 15px;
        }
        
        p {
            margin-bottom: 15px;
        }
        
        ul, ol {
            margin: 0 0 20px 20px;
        }
        
        li {
            margin-bottom: 10px;
        }
        
        .step-box {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: space-between;
        }
        
        .step {
            flex: 1;
            min-width: 220px;
            background-color: #f9f9f9;
            border-left: 4px solid #ff9900;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }
        
        .step-number {
            position: absolute;
            top: -15px;
            left: -15px;
            width: 36px;
            height: 36px;
            background-color: #ff9900;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .parameter-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0 30px;
        }
        
        .parameter-table th,
        .parameter-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .parameter-table th {
            background-color: #232f3e;
            color: white;
        }
        
        .parameter-table tr:nth-child(even) {
            background-color: #f8f8f8;
        }
        
        .parameter-table tr:hover {
            background-color: #f1f1f1;
        }
        
        .note {
            background-color: #fffaf0;
            border-left: 4px solid #ff9900;
            padding: 15px;
            margin: 20px 0;
        }
        
        .code-block {
            background-color: #272822;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
        }
        
        .key {
            color: #66d9ef;
        }
        
        .value {
            color: #a6e22e;
        }
        
        .string {
            color: #e6db74;
        }
        
        .comment {
            color: #75715e;
        }
        
        .icon-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }
        
        .icon-item {
            flex: 1;
            min-width: 150px;
            max-width: 200px;
            text-align: center;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        
        .icon {
            width: 50px;
            height: 50px;
            margin: 0 auto 10px;
            background-color: #232f3e;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }
        
        .blueprint {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin: 20px 0;
        }
        
        .blueprint-col {
            flex: 1;
            min-width: 300px;
        }
        
        .arrow {
            text-align: center;
            font-size: 24px;
            margin: 20px 0;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9em;
        }
        
        @media (max-width: 768px) {
            .step-box {
                flex-direction: column;
            }
            
            .step {
                min-width: 100%;
            }
            
            .blueprint {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>AWS CloudFormation テンプレート作成ガイド</h1>
            <div class="subtitle">インフラストラクチャをコードとして管理する方法</div>
        </header>
        
        <section class="intro">
            <h2>AWS CloudFormation とは？</h2>
            <p>AWS CloudFormation は、AWSリソースをコードとして定義し、一貫した方法でプロビジョニングするためのサービスです。JSON または YAML 形式のテンプレートファイルを作成することで、インフラストラクチャ全体を自動的にデプロイ、更新、削除できます。</p>
            
            <div class="note">
                <strong>メリット:</strong> コード化されたインフラ（IaC）により、リソース作成の自動化、再現性の向上、バージョン管理が可能になります。
            </div>
        </section>
        
        <section class="section">
            <h2>CloudFormation テンプレートの基本構造</h2>
            
            <div class="blueprint">
                <div class="blueprint-col">
                    <h3>テンプレート構造（YAML形式）</h3>
                    <div class="code-block">
<span class="comment"># テンプレートのフォーマットバージョン（必須）</span>
<span class="key">AWSTemplateFormatVersion</span>: <span class="string">"2010-09-09"</span>

<span class="comment"># テンプレートの説明（オプション）</span>
<span class="key">Description</span>: <span class="string">"シンプルなEC2インスタンスを作成するテンプレート"</span>

<span class="comment"># メタデータ（オプション）</span>
<span class="key">Metadata</span>:
  <span class="key">AWS::CloudFormation::Interface</span>:
    <span class="key">ParameterGroups</span>:
      - <span class="key">Parameters</span>:
        - <span class="string">"InstanceType"</span>

<span class="comment"># パラメータ（オプション）</span>
<span class="key">Parameters</span>:
  <span class="key">InstanceType</span>:
    <span class="key">Type</span>: <span class="string">"String"</span>
    <span class="key">Default</span>: <span class="string">"t2.micro"</span>
    <span class="key">Description</span>: <span class="string">"EC2インスタンスタイプ"</span>

<span class="comment"># マッピング（オプション）</span>
<span class="key">Mappings</span>:
  <span class="key">RegionMap</span>:
    <span class="key">ap-northeast-1</span>:
      <span class="key">AMI</span>: <span class="string">"ami-0ab0bbbd329f565e6"</span>

<span class="comment"># 条件（オプション）</span>
<span class="key">Conditions</span>:
  <span class="key">CreateProdResources</span>: <span class="string">!Equals [!Ref "Environment", "prod"]</span>

<span class="comment"># リソース（必須）</span>
<span class="key">Resources</span>:
  <span class="key">MyEC2Instance</span>:
    <span class="key">Type</span>: <span class="string">"AWS::EC2::Instance"</span>
    <span class="key">Properties</span>:
      <span class="key">InstanceType</span>: <span class="string">!Ref "InstanceType"</span>
      <span class="key">ImageId</span>: <span class="string">!FindInMap [RegionMap, !Ref "AWS::Region", AMI]</span>

<span class="comment"># 出力（オプション）</span>
<span class="key">Outputs</span>:
  <span class="key">InstanceId</span>:
    <span class="key">Description</span>: <span class="string">"EC2インスタンスID"</span>
    <span class="key">Value</span>: <span class="string">!Ref "MyEC2Instance"</span>
                    </div>
                </div>
                
                <div class="blueprint-col">
                    <h3>セクションの説明</h3>
                    <ul>
                        <li><strong>AWSTemplateFormatVersion:</strong> テンプレートの形式バージョン（現在は "2010-09-09" のみ）</li>
                        <li><strong>Description:</strong> テンプレートの説明文</li>
                        <li><strong>Metadata:</strong> テンプレートに関する追加情報</li>
                        <li><strong>Parameters:</strong> スタック作成時に指定可能なパラメータ</li>
                        <li><strong>Mappings:</strong> キーと値のマッピングテーブル</li>
                        <li><strong>Conditions:</strong> 条件付きでリソースを作成するための条件式</li>
                        <li><strong>Resources:</strong> 作成するAWSリソースの定義（必須）</li>
                        <li><strong>Outputs:</strong> スタック作成後に参照できる出力値</li>
                    </ul>
                    
                    <div class="note">
                        <strong>重要:</strong> テンプレートでは <code>Resources</code> セクションのみが必須で、他はオプションです。YAMLまたはJSON形式で記述できますが、YAMLの方が読みやすく推奨されています。
                    </div>
                </div>
            </div>
        </section>
        
        <section class="section">
            <h2>テンプレート作成の手順</h2>
            
            <div class="step-box">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>要件の定義</h3>
                    <p>作成したいインフラストラクチャの要件を明確にします。必要なリソース、依存関係、パラメータを特定します。</p>
                </div>
                
                <div class="step">
                    <div class="step-number">2</div>
                    <h3>構造の設計</h3>
                    <p>テンプレートの基本構造を設計します。必要なセクション（リソース、パラメータなど）を決めます。</p>
                </div>
                
                <div class="step">
                    <div class="step-number">3</div>
                    <h3>リソースの定義</h3>
                    <p>必要なAWSリソースを定義します。各リソースのプロパティと設定を指定します。</p>
                </div>
                
                <div class="step">
                    <div class="step-number">4</div>
                    <h3>パラメータの追加</h3>
                    <p>テンプレートを再利用可能にするためのパラメータを追加します。デフォルト値や制約を設定します。</p>
                </div>
                
                <div class="step">
                    <div class="step-number">5</div>
                    <h3>出力の定義</h3>
                    <p>参照用の出力値を定義します。これらは他のスタックで使用したり、情報表示に利用できます。</p>
                </div>
                
                <div class="step">
                    <div class="step-number">6</div>
                    <h3>テストと検証</h3>
                    <p>AWS CloudFormation コンソールやCLIでテンプレートを検証し、エラーがないことを確認します。</p>
                </div>
            </div>
        </section>
        
        <section class="section">
            <h2>代表的なパラメータと属性</h2>
            
            <h3>パラメータの型</h3>
            <table class="parameter-table">
                <thead>
                    <tr>
                        <th>パラメータ型</th>
                        <th>説明</th>
                        <th>例</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>String</td>
                        <td>文字列値</td>
                        <td>インスタンス名、キー名など</td>
                    </tr>
                    <tr>
                        <td>Number</td>
                        <td>整数または小数</td>
                        <td>ポート番号、容量サイズなど</td>
                    </tr>
                    <tr>
                        <td>AWS::EC2::VPC::Id</td>
                        <td>既存のVPC ID</td>
                        <td>vpc-0123456789abcdef0</td>
                    </tr>
                    <tr>
                        <td>AWS::EC2::Subnet::Id</td>
                        <td>既存のサブネットID</td>
                        <td>subnet-0123456789abcdef0</td>
                    </tr>
                    <tr>
                        <td>CommaDelimitedList</td>
                        <td>カンマ区切りの値リスト</td>
                        <td>test1,test2,test3</td>
                    </tr>
                    <tr>
                        <td>List<Number></td>
                        <td>数値のリスト</td>
                        <td>[80, 443, 8080]</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>パラメータの属性</h3>
            <table class="parameter-table">
                <thead>
                    <tr>
                        <th>属性</th>
                        <th>説明</th>
                        <th>例</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Default</td>
                        <td>パラメータのデフォルト値</td>
                        <td>t2.micro</td>
                    </tr>
                    <tr>
                        <td>AllowedValues</td>
                        <td>許可される値のリスト</td>
                        <td>[t2.micro, t2.small, t2.medium]</td>
                    </tr>
                    <tr>
                        <td>AllowedPattern</td>
                        <td>正規表現パターン</td>
                        <td>^[a-zA-Z0-9]*$</td>
                    </tr>
                    <tr>
                        <td>MinLength/MaxLength</td>
                        <td>文字列の長さ制限</td>
                        <td>MinLength: 1, MaxLength: 255</td>
                    </tr>
                    <tr>
                        <td>MinValue/MaxValue</td>
                        <td>数値の範囲制限</td>
                        <td>MinValue: 1, MaxValue: 65535</td>
                    </tr>
                    <tr>
                        <td>NoEcho</td>
                        <td>パラメータ値を隠す（パスワードなど）</td>
                        <td>true</td>
                    </tr>
                </tbody>
            </table>
        </section>
        
        <section class="section">
            <h2>組み込み関数</h2>
            
            <div class="icon-grid">
                <div class="icon-item">
                    <div class="icon">Ref</div>
                    <p><strong>!Ref</strong></p>
                    <p>パラメータやリソースを参照</p>
                </div>
                
                <div class="icon-item">
                    <div class="icon">Get</div>
                    <p><strong>!GetAtt</strong></p>
                    <p>リソースの属性を取得</p>
                </div>
                
                <div class="icon-item">
                    <div class="icon">Join</div>
                    <p><strong>!Join</strong></p>
                    <p>値を連結</p>
                </div>
                
                <div class="icon-item">
                    <div class="icon">Sub</div>
                    <p><strong>!Sub</strong></p>
                    <p>文字列内の変数を置換</p>
                </div>
                
                <div class="icon-item">
                    <div class="icon">Map</div>
                    <p><strong>!FindInMap</strong></p>
                    <p>マッピングから値を検索</p>
                </div>
                
                <div class="icon-item">
                    <div class="icon">If</div>
                    <p><strong>!If</strong></p>
                    <p>条件に基づいて値を選択</p>
                </div>
            </div>
            
            <h3>関数の使用例</h3>
            <div class="code-block">
<span class="comment"># パラメータの参照</span>
<span class="key">InstanceType</span>: <span class="string">!Ref "InstanceTypeParameter"</span>

<span class="comment"># リソースの属性取得</span>
<span class="key">PublicIP</span>: <span class="string">!GetAtt "MyEC2Instance.PublicIp"</span>

<span class="comment"># 文字列の連結</span>
<span class="key">BucketName</span>: <span class="string">!Join ["-", ["my-bucket", !Ref "AWS::AccountId"]]</span>

<span class="comment"># 変数置換</span>
<span class="key">Endpoint</span>: <span class="string">!Sub "https://${ApiGateway}.execute-api.${AWS::Region}.amazonaws.com/prod/"</span>

<span class="comment"># マッピングの検索</span>
<span class="key">AMI</span>: <span class="string">!FindInMap [RegionMap, !Ref "AWS::Region", AMI]</span>

<span class="comment"># 条件分岐</span>
<span class="key">EnvironmentType</span>: <span class="string">!If [IsProd, "production", "development"]</span>
            </div>
        </section>
        
        <section class="section">
            <h2>代表的なリソースタイプ</h2>
            
            <div class="blueprint">
                <div class="blueprint-col">
                    <h3>コンピューティング</h3>
                    <ul>
                        <li><strong>AWS::EC2::Instance</strong> - EC2インスタンス</li>
                        <li><strong>AWS::AutoScaling::AutoScalingGroup</strong> - Auto Scalingグループ</li>
                        <li><strong>AWS::ECS::Cluster</strong> - ECSクラスター</li>
                        <li><strong>AWS::Lambda::Function</strong> - Lambda関数</li>
                    </ul>
                    
                    <h3>ストレージ</h3>
                    <ul>
                        <li><strong>AWS::S3::Bucket</strong> - S3バケット</li>
                        <li><strong>AWS::RDS::DBInstance</strong> - RDSデータベース</li>
                        <li><strong>AWS::DynamoDB::Table</strong> - DynamoDBテーブル</li>
                        <li><strong>AWS::EFS::FileSystem</strong> - EFSファイルシステム</li>
                    </ul>
                </div>
                
                <div class="blueprint-col">
                    <h3>ネットワーキング</h3>
                    <ul>
                        <li><strong>AWS::EC2::VPC</strong> - 仮想プライベートクラウド</li>
                        <li><strong>AWS::EC2::Subnet</strong> - サブネット</li>
                        <li><strong>AWS::EC2::SecurityGroup</strong> - セキュリティグループ</li>
                        <li><strong>AWS::ElasticLoadBalancing::LoadBalancer</strong> - ロードバランサー</li>
                        <li><strong>AWS::Route53::RecordSet</strong> - DNS レコード</li>
                    </ul>
                    
                    <h3>セキュリティ</h3>
                    <ul>
                        <li><strong>AWS::IAM::Role</strong> - IAMロール</li>
                        <li><strong>AWS::IAM::Policy</strong> - IAMポリシー</li>
                        <li><strong>AWS::KMS::Key</strong> - KMS暗号化キー</li>
                    </ul>
                </div>
            </div>
        </section>
        
        <section class="section">
            <h2>実践的なテンプレート例</h2>
            
            <h3>基本的なWebサーバー構成</h3>
            <div class="code-block">
<span class="key">AWSTemplateFormatVersion</span>: <span class="string">"2010-09-09"</span>
<span class="key">Description</span>: <span class="string">"基本的なWebサーバー構成"</span>

<span class="key">Parameters</span>:
  <span class="key">InstanceType</span>:
    <span class="key">Type</span>: <span class="string">"String"</span>
    <span class="key">Default</span>: <span class="string">"t2.micro"</span>
    <span class="key">AllowedValues</span>:
      - <span class="string">"t2.micro"</span>
      - <span class="string">"t2.small"</span>
      - <span class="string">"t2.medium"</span>
    <span class="key">Description</span>: <span class="string">"EC2インスタンスタイプ"</span>
  
  <span class="key">KeyName</span>:
    <span class="key">Type</span>: <span class="string">"AWS::EC2::KeyPair::KeyName"</span>
    <span class="key">Description</span>: <span class="string">"EC2インスタンスへのSSHアクセス用のキーペア名"</span>

<span class="key">Resources</span>:
  <span class="key">WebServerSecurityGroup</span>:
    <span class="key">Type</span>: <span class="string">"AWS::EC2::SecurityGroup"</span>
    <span class="key">Properties</span>:
      <span class="key">GroupDescription</span>: <span class="string">"Webサーバー用セキュリティグループ"</span>
      <span class="key">SecurityGroupIngress</span>:
        - <span class="key">IpProtocol</span>: <span class="string">"tcp"</span>
          <span class="key">FromPort</span>: <span class="string">80</span>
          <span class="key">ToPort</span>: <span class="string">80</span>
          <span class="key">CidrIp</span>: <span class="string">"0.0.0.0/0"</span>
        - <span class="key">IpProtocol</span>: <span class="string">"tcp"</span>
          <span class="key">FromPort</span>: <span class="string">22</span>
          <span class="key">ToPort</span>: <span class="string">22</span>
          <span class="key">CidrIp</span>: <span class="string">"0.0.0.0/0"</span>

  <span class="key">WebServer</span>:
    <span class="key">Type</span>: <span class="string">"AWS::EC2::Instance"</span>
    <span class="key">Properties</span>:
      <span class="key">InstanceType</span>: <span class="string">!Ref "InstanceType"</span>
      <span class="key">SecurityGroups</span>:
        - <span class="string">!Ref "WebServerSecurityGroup"</span>
      <span class="key">KeyName</span>: <span class="string">!Ref "KeyName"</span>
      <span class="key">ImageId</span>: <span class="string">"ami-0ab0bbbd329f565e6"</span>  <span class="comment"># Amazon Linux 2 in Tokyo region</span>
      <span class="key">UserData</span>:
        <span class="key">Fn::Base64</span>: <span class="string">!Sub |
          #!/bin/bash -xe
          yum update -y
          yum install -y httpd
          systemctl start httpd
          systemctl enable httpd
          echo "<html><body><h1>CloudFormation で作成されたウェブサーバーへようこそ!</h1></body></html>" > /var/www/html/index.html</span>

<span class="key">Outputs</span>:
  <span class="key">WebsiteURL</span>:
    <span class="key">Description</span>: <span class="string">"ウェブサーバーのURL"</span>
    <span class="key">Value</span>: <span class="string">!Sub "http://${WebServer.PublicDnsName}"</span>
  <span class="key">PublicIP</span>:
    <span class="key">Description</span>: <span class="string">"EC2インスタンスのパブリックIP"</span>
    <span class="key">Value</span>: <span class="string">!GetAtt "WebServer.PublicIp"</span>
            </div>
        </section>
        
        <section class="section">
            <h2>デプロイ方法</h2>
            
            <div class="step-box">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>AWSコンソールからのデプロイ</h3>
                    <ol>
                        <li>AWSマネジメントコンソールにログイン</li>
                        <li>CloudFormationサービスに移動</li>
                        <li>「スタックの作成」→「新しいリソースを使用」をクリック</li>
                        <li>テンプレートファイルをアップロードまたはS3 URLを指定</li>
                        <li>パラメータを入力し、スタック名を設定</li>
                        <li>オプション設定を確認し、スタックを作成</li