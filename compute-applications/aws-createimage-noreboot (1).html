<h2>どのように選べばいいの？</h2>

        <div style="text-align: center; margin: 30px 0;">
            <svg width="700" height="400" viewBox="0 0 700 400" xmlns="http://www.w3.org/2000/svg">
                <!-- 背景 -->
                <rect x="10" y="10" width="680" height="380" rx="10" fill="#f5f5f5" stroke="#ddd" stroke-width="1"/>
                
                <!-- タイトル -->
                <text x="350" y="40" font-size="18" text-anchor="middle" font-weight="bold" fill="#232f3e">NoRebootパラメータの選択フローチャート</text>
                
                <!-- スタート -->
                <rect x="285" y="60" width="130" height="40" rx="20" fill="#87CEFA" stroke="#4682B4" stroke-width="2"/>
                <text x="350" y="85" font-size="14" text-anchor="middle" font-weight="bold" fill="#333">スタート</text>
                
                <!-- 決定ポイント1 -->
                <path d="M350 100 L350 130" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <polygon points="250,130 450,130 350,190" fill="#FFD700" stroke="#DAA520" stroke-width="2"/>
                <text x="350" y="150" font-size="12" text-anchor="middle" fill="#333">本番環境用のAMIですか？</text>
                
                <!-- YES分岐1 -->
                <path d="M250 160 L180 200" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <text x="200" y="175" font-size="12" text-anchor="middle" fill="#2e7d32">はい</text>
                
                <!-- 決定ポイント2-1 -->
                <polygon points="80,200 280,200 180,260" fill="#FFD700" stroke="#DAA520" stroke-width="2"/>
                <text x="180" y="220" font-size="12" text-anchor="middle" fill="#333">サービス停止が許容できますか？</text>
                
                <!-- YES分岐2-1 -->
                <path d="M130 235 L90 270" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <text x="90" y="250" font-size="12" text-anchor="middle" fill="#2e7d32">はい</text>
                
                <!-- 推奨: NoReboot = false -->
                <rect x="20" y="270" width="140" height="60" rx="8" fill="#d4edda" stroke="#5cb85c" stroke-width="2"/>
                <text x="90" y="295" font-size="12" text-anchor="middle" font-weight="bold" fill="#333">NoReboot = false</text>
                <text x="90" y="315" font-size="10" text-anchor="middle" fill="#2e7d32">（デフォルト・再起動あり）</text>
                
                <!-- NO分岐2-1 -->
                <path d="M230 235 L270 270" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <text x="265" y="250" font-size="12" text-anchor="middle" fill="#a52a2a">いいえ</text>
                
                <!-- 条件付き推奨 -->
                <rect x="200" y="270" width="150" height="90" rx="8" fill="#fff3cd" stroke="#ffc107" stroke-width="2"/>
                <text x="275" y="290" font-size="12" text-anchor="middle" font-weight="bold" fill="#333">NoReboot = true</text>
                <text x="275" y="310" font-size="10" text-anchor="middle" fill="#8a6d3b">整合性リスク対策を実施：</text>
                <text x="275" y="330" font-size="9" text-anchor="middle" fill="#8a6d3b">・syncコマンドの実行</text>
                <text x="275" y="345" font-size="9" text-anchor="middle" fill="#8a6d3b">・DBのフラッシュと一時停止</text>
                
                <!-- NO分岐1 -->
                <path d="M450 160 L520 200" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <text x="500" y="175" font-size="12" text-anchor="middle" fill="#a52a2a">いいえ</text>
                
                <!-- 決定ポイント2-2 -->
                <polygon points="430,200 610,200 520,260" fill="#FFD700" stroke="#DAA520" stroke-width="2"/>
                <text x="520" y="220" font-size="12" text-anchor="middle" fill="#333">データの整合性が重要ですか？</text>
                
                <!-- YES分岐2-2 -->
                <path d="M475 235 L430 270" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <text x="440" y="250" font-size="12" text-anchor="middle" fill="#2e7d32">はい</text>
                
                <!-- 推奨: NoReboot = false -->
                <rect x="360" y="270" width="140" height="60" rx="8" fill="#d4edda" stroke="#5cb85c" stroke-width="2"/>
                <text x="430" y="295" font-size="12" text-anchor="middle" font-weight="bold" fill="#333">NoReboot = false</text>
                <text x="430" y="315" font-size="10" text-anchor="middle" fill="#2e7d32">（デフォルト・再起動あり）</text>
                
                <!-- NO分岐2-2 -->
                <path d="M565 235 L610 270" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <text x="600" y="250" font-size="12" text-anchor="middle" fill="#a52a2a">いいえ</text>
                
                <!-- 許容可: NoReboot = true -->
                <rect x="540" y="270" width="140" height="60" rx="8" fill="#f8d7da" stroke="#dc3545" stroke-width="2"/>
                <text x="610" y="295" font-size="12" text-anchor="middle" font-weight="bold" fill="#333">NoReboot = true</text>
                <text x="610" y="315" font-size="10" text-anchor="middle" fill="#721c24">（再起動なし）</text>
            </svg>
        </div><!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS createImage NoRebootパラメータの解説</title>
    <style>
        body {
            font-family: 'Segoe UI', 'Meiryo', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1, h2, h3 {
            color: #232f3e;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #ff9900;
        }
        .highlight {
            color: #ff9900;
            font-weight: bold;
        }
        .comparison {
            display: flex;
            gap: 20px;
            margin: 30px 0;
        }
        .option {
            flex: 1;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .option.reboot {
            background-color: #feeedc;
            border: 1px solid #ff9900;
        }
        .option.noreboot {
            background-color: #e7f5fd;
            border: 1px solid #0073bb;
        }
        .option-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .option-title {
            margin-left: 15px;
            font-size: 1.2em;
            font-weight: bold;
        }
        .pros-cons {
            margin-top: 15px;
        }
        .pro, .con {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        .pro:before {
            content: "✓";
            color: #0a8754;
            font-weight: bold;
            margin-right: 10px;
        }
        .con:before {
            content: "✗";
            color: #d13212;
            font-weight: bold;
            margin-right: 10px;
        }
        .flowchart {
            margin: 40px 0;
            text-align: center;
        }
        .step {
            display: inline-block;
            background-color: #f0f7ff;
            border: 1px solid #0073bb;
            border-radius: 8px;
            padding: 15px 20px;
            margin: 10px;
            position: relative;
        }
        .step:after {
            content: "→";
            position: absolute;
            right: -25px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            color: #0073bb;
        }
        .step:last-child:after {
            content: "";
        }
        .decision {
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background-color: #f9f9f9;
        }
        .decision-title {
            text-align: center;
            margin-bottom: 15px;
            color: #232f3e;
            font-weight: bold;
        }
        .example {
            background-color: #f7f7f7;
            border-left: 4px solid #0073bb;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .note {
            background-color: #fff8e6;
            border-left: 4px solid #ff9900;
            padding: 15px;
            margin: 20px 0;
        }
        .footer {
            margin-top: 40px;
            text-align: center;
            font-size: 0.9em;
            color: #666;
        }
        .icon {
            width: 40px;
            height: 40px;
            display: inline-block;
            background-color: #f5f5f5;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AWS EC2 <span class="highlight">createImage</span>の<span class="highlight">NoReboot</span>パラメータ解説</h1>
            <p>〜初心者のためのわかりやすいガイド〜</p>
        </div>

        <h2>createImageコマンドとは？</h2>
        <p>
            AWSのEC2（Elastic Compute Cloud）で実行中のインスタンスから<strong>AMI（Amazon Machine Image）</strong>を作成するコマンドです。AMIはインスタンスの「スナップショット」のようなもので、OSやアプリケーションを含む設定を保存し、後で新しいインスタンスを起動する際に利用できます。
        </p>

        <div class="flowchart">
            <div class="step">実行中のEC2インスタンス</div>
            <div class="step">createImageコマンド実行</div>
            <div class="step">AMI作成</div>
            <div class="step">新しいインスタンスを起動可能</div>
        </div>

        <h2>NoRebootパラメータとは？</h2>
        <p>
            <strong>NoReboot</strong>パラメータは、AMI作成時にインスタンスを再起動するかどうかを制御するフラグです。
        </p>

        <div class="comparison">
            <div class="option reboot">
                <div class="option-header">
                    <div class="icon">R</div>
                    <div class="option-title">NoReboot = false（デフォルト）</div>
                </div>
                <p>インスタンスが<strong>再起動</strong>されます</p>
                <div class="pros-cons">
                    <div class="pro">ファイルシステムの整合性が確保される</div>
                    <div class="pro">データの一貫性が高い</div>
                    <div class="pro">確実にキャッシュがディスクに書き込まれる</div>
                    <div class="con">サービスが一時的に停止する</div>
                    <div class="con">ユーザーに影響が出る可能性がある</div>
                </div>
            </div>

            <div class="option noreboot">
                <div class="option-header">
                    <div class="icon">N</div>
                    <div class="option-title">NoReboot = true</div>
                </div>
                <p>インスタンスは<strong>再起動せず</strong>に続行</p>
                <div class="pros-cons">
                    <div class="pro">サービスが中断されない</div>
                    <div class="pro">ユーザーに影響が出ない</div>
                    <div class="pro">24時間稼働が必要なシステムに最適</div>
                    <div class="con">ファイルシステムの整合性が保証されない</div>
                    <div class="con">キャッシュデータが含まれない可能性</div>
                    <div class="con">不完全なAMIが作成されるリスク</div>
                </div>
            </div>
        </div>

        <div class="note">
            <strong>重要:</strong> NoReboot = trueの場合、ファイルシステムの整合性は保証されません。そのため、作成されたAMIから起動したインスタンスで問題が発生する可能性があります。
        </div>

        <h2>ファイルシステムの整合性について</h2>
        <p>
            ファイルシステムの整合性とは、コンピュータのファイルシステム（データの保存と管理を行う仕組み）が一貫した正常な状態にあることを指します。
        </p>
        
        <!-- 図解：ファイルシステムの整合性 -->
        <div style="text-align: center; margin: 30px 0;">
            <svg width="700" height="350" viewBox="0 0 700 350" xmlns="http://www.w3.org/2000/svg">
                <!-- 背景 -->
                <rect x="10" y="10" width="680" height="330" rx="10" fill="#f5f5f5" stroke="#ddd" stroke-width="1"/>
                
                <!-- タイトル -->
                <text x="350" y="40" font-size="18" text-anchor="middle" font-weight="bold" fill="#232f3e">ファイルシステムの整合性の図解</text>
                
                <!-- 左側：整合性あり -->
                <rect x="40" y="60" width="280" height="260" rx="8" fill="#e7ffd9" stroke="#5cb85c" stroke-width="2"/>
                <text x="180" y="85" font-size="16" text-anchor="middle" font-weight="bold" fill="#2e7d32">整合性が保たれた状態</text>
                
                <!-- アプリケーション・メモリ・ディスク図（左） -->
                <rect x="70" y="100" width="220" height="60" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="180" y="125" font-size="14" text-anchor="middle" fill="#333">アプリケーション</text>
                <text x="180" y="145" font-size="12" text-anchor="middle" fill="#666">データ処理と変更</text>
                
                <!-- メモリ -->
                <rect x="70" y="180" width="220" height="60" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="180" y="205" font-size="14" text-anchor="middle" fill="#333">メモリ（キャッシュ）</text>
                <text x="180" y="225" font-size="12" text-anchor="middle" fill="#666">一時的なデータ保存</text>
                
                <!-- ディスク -->
                <rect x="70" y="260" width="220" height="40" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="180" y="285" font-size="14" text-anchor="middle" fill="#333">ディスク（永続的なストレージ）</text>
                
                <!-- データフロー矢印（左） -->
                <path d="M180 160 L180 180" stroke="#5cb85c" stroke-width="2" marker-end="url(#arrowhead)"/>
                <path d="M180 240 L180 260" stroke="#5cb85c" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="200" y="170" font-size="12" fill="#2e7d32">書き込み</text>
                <text x="200" y="250" font-size="12" fill="#2e7d32">フラッシュ完了</text>
                
                <!-- 右側：整合性なし -->
                <rect x="380" y="60" width="280" height="260" rx="8" fill="#ffecec" stroke="#d9534f" stroke-width="2"/>
                <text x="520" y="85" font-size="16" text-anchor="middle" font-weight="bold" fill="#a52a2a">整合性リスクがある状態</text>
                
                <!-- アプリケーション・メモリ・ディスク図（右） -->
                <rect x="410" y="100" width="220" height="60" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="520" y="125" font-size="14" text-anchor="middle" fill="#333">アプリケーション</text>
                <text x="520" y="145" font-size="12" text-anchor="middle" fill="#666">データ処理と変更</text>
                
                <!-- メモリ（未書き込みデータあり） -->
                <rect x="410" y="180" width="220" height="60" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="520" y="205" font-size="14" text-anchor="middle" fill="#333">メモリ（キャッシュ）</text>
                <text x="520" y="225" font-size="12" text-anchor="middle" fill="#a52a2a">未書き込みデータあり！</text>
                
                <!-- ディスク -->
                <rect x="410" y="260" width="220" height="40" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="520" y="285" font-size="14" text-anchor="middle" fill="#333">ディスク（永続的なストレージ）</text>
                
                <!-- データフロー矢印（右） -->
                <path d="M520 160 L520 180" stroke="#5cb85c" stroke-width="2" marker-end="url(#arrowhead)"/>
                <path d="M520 240 L520 260" stroke="#d9534f" stroke-width="2" stroke-dasharray="4 2"/>
                <text x="540" y="170" font-size="12" fill="#2e7d32">書き込み</text>
                <text x="540" y="250" font-size="12" fill="#a52a2a">フラッシュされない！</text>
                
                <!-- 矢印の定義 -->
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
                    </marker>
                </defs>
            </svg>
        </div>
        
        <div class="comparison">
            <div class="option reboot">
                <div class="option-header">
                    <div class="icon">✓</div>
                    <div class="option-title">整合性が保たれた状態</div>
                </div>
                <ul>
                    <li><strong>メモリキャッシュの書き込み完了</strong> - OSはパフォーマンス向上のため、変更データを一時的にメモリに保持し、後でディスクに書き込みます。再起動すると、このキャッシュが強制的にディスクに書き込まれます。</li>
                    <li><strong>データの一貫性</strong> - ファイルの内容とそのメタデータ（ファイル名、サイズ、作成日時など）が矛盾なく保たれています。</li>
                    <li><strong>トランザクションの完了</strong> - データベースなどのアプリケーションが処理中のトランザクションを適切に完了または巻き戻します。</li>
                </ul>
            </div>

            <div class="option noreboot">
                <div class="option-header">
                    <div class="icon">!</div>
                    <div class="option-title">整合性が損なわれるリスク</div>
                </div>
                <ul>
                    <li><strong>未書き込みのキャッシュデータ</strong> - メモリ上のデータがディスクに書き込まれていない状態でAMIが作成されると、そのデータは失われます。</li>
                    <li><strong>処理中のトランザクション</strong> - データベースやアプリケーションが処理途中のトランザクションがその状態で「凍結」されます。</li>
                    <li><strong>ジャーナリングの不完全</strong> - 多くの現代的なファイルシステムはジャーナリングを使用していますが、これが不完全な状態で保存される可能性があります。</li>
                </ul>
            </div>
        </div>

        <!-- AMI作成プロセスの図解 -->
        <h3>NoRebootパラメータとAMI作成プロセス</h3>
        <div style="text-align: center; margin: 30px 0;">
            <svg width="700" height="500" viewBox="0 0 700 500" xmlns="http://www.w3.org/2000/svg">
                <!-- 背景 -->
                <rect x="10" y="10" width="680" height="480" rx="10" fill="#f5f5f5" stroke="#ddd" stroke-width="1"/>
                
                <!-- タイトル -->
                <text x="350" y="40" font-size="18" text-anchor="middle" font-weight="bold" fill="#232f3e">NoRebootパラメータによるAMI作成プロセスの違い</text>
                
                <!-- NoReboot = false（左側） -->
                <rect x="40" y="60" width="280" height="410" rx="8" fill="#e7ffd9" stroke="#5cb85c" stroke-width="2"/>
                <text x="180" y="85" font-size="16" text-anchor="middle" font-weight="bold" fill="#2e7d32">NoReboot = false（再起動あり）</text>
                
                <!-- NoReboot = true（右側） -->
                <rect x="380" y="60" width="280" height="410" rx="8" fill="#fff8dc" stroke="#f0ad4e" stroke-width="2"/>
                <text x="520" y="85" font-size="16" text-anchor="middle" font-weight="bold" fill="#8a6d3b">NoReboot = true（再起動なし）</text>
                
                <!-- 左側のプロセス -->
                <rect x="70" y="110" width="220" height="40" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="180" y="135" font-size="14" text-anchor="middle" fill="#333">1. createImageコマンド実行</text>
                
                <rect x="70" y="170" width="220" height="40" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="180" y="195" font-size="14" text-anchor="middle" fill="#333">2. インスタンスのシャットダウン開始</text>
                
                <rect x="70" y="230" width="220" height="40" rx="5" fill="#b3e0ff" stroke="#333" stroke-width="1"/>
                <text x="180" y="255" font-size="14" text-anchor="middle" fill="#333">3. アプリケーション終了処理</text>
                
                <rect x="70" y="290" width="220" height="40" rx="5" fill="#b3e0ff" stroke="#333" stroke-width="1"/>
                <text x="180" y="315" font-size="14" text-anchor="middle" fill="#333">4. キャッシュをディスクに書き込み</text>
                
                <rect x="70" y="350" width="220" height="40" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="180" y="375" font-size="14" text-anchor="middle" fill="#333">5. AMI作成</text>
                
                <rect x="70" y="410" width="220" height="40" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="180" y="435" font-size="14" text-anchor="middle" fill="#333">6. インスタンス再起動</text>
                
                <!-- プロセス間の矢印（左） -->
                <path d="M180 150 L180 170" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <path d="M180 210 L180 230" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <path d="M180 270 L180 290" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <path d="M180 330 L180 350" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <path d="M180 390 L180 410" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                
                <!-- 右側のプロセス -->
                <rect x="410" y="110" width="220" height="40" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="520" y="135" font-size="14" text-anchor="middle" fill="#333">1. createImageコマンド実行</text>
                
                <rect x="410" y="170" width="220" height="40" rx="5" fill="#ffcccc" stroke="#d9534f" stroke-width="1"/>
                <text x="520" y="195" font-size="14" text-anchor="middle" fill="#333">2. インスタンスは稼働したまま</text>
                
                <rect x="410" y="230" width="220" height="40" rx="5" fill="#ffcccc" stroke="#d9534f" stroke-width="1"/>
                <text x="520" y="255" font-size="14" text-anchor="middle" fill="#333">3. アプリケーションも稼働中</text>
                
                <rect x="410" y="290" width="220" height="40" rx="5" fill="#ffcccc" stroke="#d9534f" stroke-width="1"/>
                <text x="520" y="315" font-size="14" text-anchor="middle" fill="#333">4. キャッシュは未書き込みのまま</text>
                
                <rect x="410" y="350" width="220" height="40" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="520" y="375" font-size="14" text-anchor="middle" fill="#333">5. AMI作成</text>
                
                <rect x="410" y="410" width="220" height="40" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="520" y="435" font-size="14" text-anchor="middle" fill="#333">6. インスタンスは稼働継続</text>
                
                <!-- プロセス間の矢印（右） -->
                <path d="M520 150 L520 170" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <path d="M520 210 L520 230" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <path d="M520 270 L520 290" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <path d="M520 330 L520 350" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <path d="M520 390 L520 410" stroke="#333" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                
                <!-- キーポイント -->
                <text x="180" y="460" font-size="14" font-weight="bold" text-anchor="middle" fill="#2e7d32">結果: 整合性の高いAMI</text>
                <text x="520" y="460" font-size="14" font-weight="bold" text-anchor="middle" fill="#a52a2a">結果: 整合性リスクあり</text>
            </svg>
        </div>

        <h3>具体的な問題の例</h3>
        <div style="text-align: center; margin: 30px 0;">
            <svg width="700" height="320" viewBox="0 0 700 320" xmlns="http://www.w3.org/2000/svg">
                <!-- 背景 -->
                <rect x="10" y="10" width="680" height="300" rx="10" fill="#f8f9fa" stroke="#ddd" stroke-width="1"/>
                
                <!-- タイトル -->
                <text x="350" y="40" font-size="18" text-anchor="middle" font-weight="bold" fill="#232f3e">NoReboot = true で発生する可能性がある問題</text>
                
                <!-- 問題例1: データベースの破損 -->
                <rect x="40" y="70" width="200" height="220" rx="8" fill="#ffecec" stroke="#d9534f" stroke-width="2"/>
                <text x="140" y="95" font-size="14" text-anchor="middle" font-weight="bold" fill="#a52a2a">データベースの破損</text>
                
                <!-- DB図 -->
                <rect x="60" y="110" width="160" height="40" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="140" y="135" font-size="12" text-anchor="middle" fill="#333">データベースプロセス</text>
                
                <rect x="60" y="170" width="160" height="40" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <rect x="60" y="170" width="80" height="40" rx="0" fill="#b3e0ff" stroke="#333" stroke-width="1"/>
                <text x="140" y="195" font-size="12" text-anchor="middle" fill="#333">DBファイル（更新中）</text>
                
                <path d="M140 150 L140 170" stroke="#d9534f" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <text x="170" y="165" font-size="10" fill="#a52a2a">部分的な書き込み</text>
                
                <text x="140" y="230" font-size="11" text-anchor="middle" fill="#333">AMI作成時に更新が</text>
                <text x="140" y="245" font-size="11" text-anchor="middle" fill="#333">途中のファイルが含まれる</text>
                <text x="140" y="265" font-size="11" text-anchor="middle" fill="#a52a2a">→ 起動時にDBエラー</text>
                
                <!-- 問題例2: 設定ファイルの不整合 -->
                <rect x="250" y="70" width="200" height="220" rx="8" fill="#ffecec" stroke="#d9534f" stroke-width="2"/>
                <text x="350" y="95" font-size="14" text-anchor="middle" font-weight="bold" fill="#a52a2a">設定ファイルの不整合</text>
                
                <!-- 設定ファイル図 -->
                <rect x="270" y="110" width="160" height="40" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="350" y="135" font-size="12" text-anchor="middle" fill="#333">設定更新プロセス</text>
                
                <rect x="270" y="170" width="160" height="60" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="350" y="190" font-size="10" text-anchor="middle" fill="#333">config.json</text>
                <text x="350" y="210" font-size="9" text-anchor="middle" fill="#a52a2a">{不完全なJSON}</text>
                
                <path d="M350 150 L350 170" stroke="#d9534f" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <text x="380" y="165" font-size="10" fill="#a52a2a">更新途中</text>
                
                <text x="350" y="245" font-size="11" text-anchor="middle" fill="#333">一部だけ更新された設定</text>
                <text x="350" y="265" font-size="11" text-anchor="middle" fill="#a52a2a">→ アプリ起動失敗</text>
                
                <!-- 問題例3: ログファイルの不完全 -->
                <rect x="460" y="70" width="200" height="220" rx="8" fill="#fff8dc" stroke="#f0ad4e" stroke-width="2"/>
                <text x="560" y="95" font-size="14" text-anchor="middle" font-weight="bold" fill="#8a6d3b">ログファイルの不完全</text>
                
                <!-- ログファイル図 -->
                <rect x="480" y="110" width="160" height="40" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="560" y="135" font-size="12" text-anchor="middle" fill="#333">ロギングプロセス</text>
                
                <rect x="480" y="170" width="160" height="60" rx="5" fill="#ffffff" stroke="#333" stroke-width="1"/>
                <text x="560" y="190" font-size="10" text-anchor="middle" fill="#333">application.log</text>
                <text x="560" y="210" font-size="9" text-anchor="middle" fill="#8a6d3b">メモリバッファに残るログ</text>
                
                <path d="M560 150 L560 170" stroke="#f0ad4e" stroke-width="1.5" marker-end="url(#arrowhead)"/>
                <text x="590" y="165" font-size="10" fill="#8a6d3b">バッファリング中</text>
                
                <text x="560" y="245" font-size="11" text-anchor="middle" fill="#333">最新のログエントリが欠落</text>
                <text x="560" y="265" font-size="11" text-anchor="middle" fill="#8a6d3b">→ トラブルシューティング困難</text>
            </svg>
        </div>

        <div class="example">
# ファイルシステムの整合性を手動で高める方法（NoReboot = trueを使用する場合）
# AMI作成前にこれらのコマンドを実行

# メモリキャッシュをディスクに強制的に書き込む
sudo sync

# データベースの場合は、書き込み操作を一時停止またはフラッシュする
# MySQLの例:
sudo mysql -e "FLUSH TABLES WITH READ LOCK;"

# AMI作成後にロックを解除
# sudo mysql -e "UNLOCK TABLES;"
        </div>

        <h2>どのように選べばいいの？</h2>

        <div class="decision">
            <div class="decision-title">選択の目安</div>
            
            <!-- 2列の表形式の比較図 -->
            <div style="display: flex; margin: 20px 0;">
                <div style="flex: 1; padding: 15px; background-color: #d4edda; border-radius: 8px 0 0 8px; border: 1px solid #c3e6cb;">
                    <div style="text-align: center; margin-bottom: 15px; font-weight: bold; color: #155724;">
                        <div style="font-size: 40px; margin-bottom: 5px;">⟳</div>
                        NoReboot = false<br>（再起動あり）
                    </div>
                    <ul style="list-style-type: none; padding-left: 10px;">
                        <li style="margin-bottom: 8px; display: flex; align-items: center;">
                            <span style="color: #28a745; font-size: 18px; margin-right: 8px;">✓</span>
                            <span>本番環境で使用するAMIの作成</span>
                        </li>
                        <li style="margin-bottom: 8px; display: flex; align-items: center;">
                            <span style="color: #28a745; font-size: 18px; margin-right: 8px;">✓</span>
                            <span>データの整合性が最も重要な場合</span>
                        </li>
                        <li style="margin-bottom: 8px; display: flex; align-items: center;">
                            <span style="color: #28a745; font-size: 18px; margin-right: 8px;">✓</span>
                            <span>計画的なメンテナンス時間内での実行</span>
                        </li>
                        <li style="margin-bottom: 8px; display: flex; align-items: center;">
                            <span style="color: #28a745; font-size: 18px; margin-right: 8px;">✓</span>
                            <span>データベースを含むシステム</span>
                        </li>
                        <li style="margin-bottom: 8px; display: flex; align-items: center;">
                            <span style="color: #28a745; font-size: 18px; margin-right: 8px;">✓</span>
                            <span>正常なシステム状態を確実に捉えたい</span>
                        </li>
                    </ul>
                </div>
                <div style="flex: 1; padding: 15px; background-color: #fff3cd; border-radius: 0 8px 8px 0; border: 1px solid #ffeeba; border-left: none;">
                    <div style="text-align: center; margin-bottom: 15px; font-weight: bold; color: #856404;">
                        <div style="font-size: 40px; margin-bottom: 5px;">⊗</div>
                        NoReboot = true<br>（再起動なし）
                    </div>
                    <ul style="list-style-type: none; padding-left: 10px;">
                        <li style="margin-bottom: 8px; display: flex; align-items: center;">
                            <span style="color: #ffc107; font-size: 18px; margin-right: 8px;">⚠</span>
                            <span>サービス中断を避けたい24時間稼働システム</span>
                        </li>
                        <li style="margin-bottom: 8px; display: flex; align-items: center;">
                            <span style="color: #ffc107; font-size: 18px; margin-right: 8px;">⚠</span>
                            <span>テスト用/バックアップ用のAMI作成</span>
                        </li>
                        <li style="margin-bottom: 8px; display: flex; align-items: center;">
                            <span style="color: #ffc107; font-size: 18px; margin-right: 8px;">⚠</span>
                            <span>ファイルシステムの同期が手動実行できる環境</span>
                        </li>
                        <li style="margin-bottom: 8px; display: flex; align-items: center;">
                            <span style="color: #ffc107; font-size: 18px; margin-right: 8px;">⚠</span>
                            <span>静的コンテンツ中心のシステム</span>
                        </li>
                        <li style="margin-bottom: 8px; display: flex; align-items: center;">
                            <span style="color: #ffc107; font-size: 18px; margin-right: 8px;">⚠</span>
                            <span>リスクを理解した上で保守運用できる場合</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <h2>コマンド例</h2>

        <!-- コマンド例のプレビュー図 -->
        <div style="text-align: center; margin: 20px 0;">
            <svg width="700" height="220" viewBox="0 0 700 220" xmlns="http://www.w3.org/2000/svg">
                <!-- 背景 -->
                <rect x="10" y="10" width="680" height="200" rx="10" fill="#2b2b2b" stroke="#444" stroke-width="1"/>
                
                <!-- ターミナルヘッダー -->
                <rect x="10" y="10" width="680" height="30" rx="10" fill="#444" stroke="#444" stroke-width="1"/>
                <circle cx="30" cy="25" r="7" fill="#ff5f57"/>
                <circle cx="50" cy="25" r="7" fill="#febc2e"/>
                <circle cx="70" cy="25" r="7" fill="#28c840"/>
                <text x="350" y="28" font-size="12" text-anchor="middle" fill="#ccc">AWS CLI Terminal</text>

                <!-- コマンド1 -->
                <text x="25" y="60" font-size="12" text-anchor="start" fill="#64dd17">user@aws-cli:~$</text>
                <text x="130" y="60" font-size="12" text-anchor="start" fill="#fff">aws ec2 create-image \</text>
                <text x="150" y="80" font-size="12" text-anchor="start" fill="#fff">--instance-id i-1234567890abcdef0 \</text>
                <text x="150" y="100" font-size="12" text-anchor="start" fill="#fff">--name "MyServerImage" \</text>
                <text x="150" y="120" font-size="12" text-anchor="start" fill="#fff">--description "イメージの説明"</text>

                <!-- 出力1 -->
                <rect x="130" y="140" width="400" height="20" rx="3" fill="#333" stroke="#555" stroke-width="1"/>
                <text x="140" y="155" font-size="11" text-anchor="start" fill="#4fc3f7">{</text>
                <text x="150" y="155" font-size="11" text-anchor="start" fill="#fff">"ImageId": "ami-0a1b2c3d4e5f6a7b8"</text>
                <text x="390" y="155" font-size="11" text-anchor="start" fill="#4fc3f7">}</text>

                <!-- 注釈1 -->
                <text x="540" y="100" font-size="14" text-anchor="start" fill="#64dd17">✓ デフォルト設定</text>
                <text x="540" y="120" font-size="12" text-anchor="start" fill="#fff">再起動あり</text>
            </svg>
        </div>

        <div style="text-align: center; margin: 20px 0;">
            <svg width="700" height="240" viewBox="0 0 700 240" xmlns="http://www.w3.org/2000/svg">
                <!-- 背景 -->
                <rect x="10" y="10" width="680" height="220" rx="10" fill="#2b2b2b" stroke="#444" stroke-width="1"/>
                
                <!-- ターミナルヘッダー -->
                <rect x="10" y="10" width="680" height="30" rx="10" fill="#444" stroke="#444" stroke-width="1"/>
                <circle cx="30" cy="25" r="7" fill="#ff5f57"/>
                <circle cx="50" cy="25" r="7" fill="#febc2e"/>
                <circle cx="70" cy="25" r="7" fill="#28c840"/>
                <text x="350" y="28" font-size="12" text-anchor="middle" fill="#ccc">AWS CLI Terminal</text>

                <!-- コマンド2 -->
                <text x="25" y="60" font-size="12" text-anchor="start" fill="#64dd17">user@aws-cli:~$</text>
                <text x="130" y="60" font-size="12" text-anchor="start" fill="#fff">aws ec2 create-image \</text>
                <text x="150" y="80" font-size="12" text-anchor="start" fill="#fff">--instance-id i-1234567890abcdef0 \</text>
                <text x="150" y="100" font-size="12" text-anchor="start" fill="#fff">--name "MyServerImage-NoReboot" \</text>
                <text x="150" y="120" font-size="12" text-anchor="start" fill="#fff">--description "イメージの説明" \</text>
                <text x="150" y="140" font-size="12" text-anchor="start" fill="#ffc107">--no-reboot</text>

                <!-- 出力2 -->
                <rect x="130" y="160" width="400" height="20" rx="3" fill="#333" stroke="#555" stroke-width="1"/>
                <text x="140" y="175" font-size="11" text-anchor="start" fill="#4fc3f7">{</text>
                <text x="150" y="175" font-size="11" text-anchor="start" fill="#fff">"ImageId": "ami-9z8y7x6w5v4u3t2s"</text>
                <text x="390" y="175" font-size="11" text-anchor="start" fill="#4fc3f7">}</text>

                <!-- 注釈2 -->
                <text x="540" y="140" font-size="14" text-anchor="start" fill="#ffc107">⚠ --no-reboot</text>
                <text x="540" y="160" font-size="12" text-anchor="start" fill="#fff">再起動なし</text>
                <text x="540" y="180" font-size="12" text-anchor="start" fill="#ff5252">整合性リスクあり</text>
            </svg>
        </div>

        <div class="example">
# AWS CLIでの実行例（再起動あり - デフォルト）
aws ec2 create-image \
    --instance-id i-1234567890abcdef0 \
    --name "MyServerImage" \
    --description "イメージの説明"

# 再起動なしでAMIを作成
aws ec2 create-image \
    --instance-id i-1234567890abcdef0 \
    --name "MyServerImage-NoReboot" \
    --description "イメージの説明" \
    --no-reboot</div>

        <h3>ベストプラクティス</h3>
        <!-- ベストプラクティスの図解 -->
        <div style="display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin: 20px 0;">
            <!-- プラクティス1 -->
            <div style="width: 300px; background-color: #f8f9fa; border-radius: 10px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <div style="width: 40px; height: 40px; background-color: #4682B4; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-right: 10px;">
                        <span style="color: white; font-weight: bold; font-size: 20px;">1</span>
                    </div>
                    <div style="font-weight: bold; color: #4682B4;">デフォルト設定を優先</div>
                </div>
                <p style="margin: 0; font-size: 0.9em;">可能な限り<strong>NoReboot = false</strong>（デフォルト設定）を使用して、データの整合性を確保しましょう。</p>
            </div>
            
            <!-- プラクティス2 -->
            <div style="width: 300px; background-color: #f8f9fa; border-radius: 10px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <div style="width: 40px; height: 40px; background-color: #4682B4; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-right: 10px;">
                        <span style="color: white; font-weight: bold; font-size: 20px;">2</span>
                    </div>
                    <div style="font-weight: bold; color: #4682B4;">同期を忘れずに</div>
                </div>
                <p style="margin: 0; font-size: 0.9em;">再起動できない場合は、AMI作成前にファイルシステムを同期する（<code>sync</code>コマンド）ことで整合性を高めましょう。</p>
            </div>
            
            <!-- プラクティス3 -->
            <div style="width: 300px; background-color: #f8f9fa; border-radius: 10px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <div style="width: 40px; height: 40px; background-color: #4682B4; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-right: 10px;">
                        <span style="color: white; font-weight: bold; font-size: 20px;">3</span>
                    </div>
                    <div style="font-weight: bold; color: #4682B4;">必ずテストを実施</div>
                </div>
                <p style="margin: 0; font-size: 0.9em;">NoReboot = trueで作成したAMIは、本番環境に使用する前に十分にテストして、問題がないことを確認しましょう。</p>
            </div>
            
            <!-- プラクティス4 -->
            <div style="width: 300px; background-color: #f8f9fa; border-radius: 10px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <div style="width: 40px; height: 40px; background-color: #4682B4; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-right: 10px;">
                        <span style="color: white; font-weight: bold; font-size: 20px;">4</span>
                    </div>
                    <div style="font-weight: bold; color: #4682B4;">計画的なメンテナンス</div>
                </div>
                <p style="margin: 0; font-size: 0.9em;">定期的なAMIバックアップには自動化スクリプトと計画的なメンテナンス時間を活用しましょう。</p>
            </div>
        </div>

        <!-- まとめ図 -->
        <div style="text-align: center; margin: 30px 0;">
            <svg width="700" height="200" viewBox="0 0 700 200" xmlns="http://www.w3.org/2000/svg">
                <!-- 背景 -->
                <rect x="10" y="10" width="680" height="180" rx="10" fill="#e6f7ff" stroke="#91d5ff" stroke-width="1"/>
                
                <!-- タイトル -->
                <text x="350" y="40" font-size="18" text-anchor="middle" font-weight="bold" fill="#096dd9">まとめ: NoRebootパラメータの使い分け</text>
                
                <!-- 左側：推奨 -->
                <rect x="40" y="60" width="300" height="110" rx="8" fill="#ffffff" stroke="#52c41a" stroke-width="2"/>
                <text x="190" y="85" font-size="14" text-anchor="middle" font-weight="bold" fill="#52c41a">NoReboot = false（デフォルト）</text>
                <text x="190" y="115" font-size="12" text-anchor="middle" fill="#333">• データの整合性が最も重要</text>
                <text x="190" y="135" font-size="12" text-anchor="middle" fill="#333">• 短時間の停止が許容できる場合</text>
                <text x="190" y="155" font-size="12" text-anchor="middle" fill="#333">• 本番環境のAMI作成</text>
                
                <!-- 右側：代替案 -->
                <rect x="360" y="60" width="300" height="110" rx="8" fill="#ffffff" stroke="#faad14" stroke-width="2"/>
                <text x="510" y="85" font-size="14" text-anchor="middle" font-weight="bold" fill="#faad14">NoReboot = true（要注意）</text>
                <text x="510" y="115" font-size="12" text-anchor="middle" fill="#333">• サービス継続が最優先</text>
                <text x="510" y="135" font-size="12" text-anchor="middle" fill="#333">• 整合性リスク対策を実施</text>
                <text x="510" y="155" font-size="12" text-anchor="middle" fill="#333">• 十分なテストを実施</text>
            </svg>
        </div>

        <div class="footer">
            <p>※このガイドはAWS初心者向けの概要説明です。詳細はAWS公式ドキュメントをご参照ください。</p>
            <p>© 2025 AWS入門ガイド</p>
        </div>
                
    </div>
    <button style="position: fixed; bottom: 30px; right: 30px; background-color: #FF9900; color: white; border: none; padding: 15px 30px; border-radius: 50px; font-size: 1.1em; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(255, 153, 0, 0.3); transition: all 0.3s ease; z-index: 1000;" onclick="window.location.href='../index.html'" onmouseover="this.style.backgroundColor='#E68900'; this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 16px rgba(255, 153, 0, 0.4)';" onmouseout="this.style.backgroundColor='#FF9900'; this.style.transform='scale(1)'; this.style.boxShadow='0 4px 12px rgba(255, 153, 0, 0.3)';">🏠 ホームに戻る</button>


    <div style="text-align: center; padding: 20px; margin-top: 40px; border-top: 2px solid #E5E7EB; background-color: #F9FAFB;">
        <p style="color: #6B7280; font-size: 0.9em; margin: 0;">
            Created by <a href="https://github.com/suzuki100603" target="_blank" style="color: #FF9900; text-decoration: none; font-weight: 600;">suzuki100603</a>
        </p>
        <p style="color: #9CA3AF; font-size: 0.8em; margin: 5px 0 0 0;">
            AWS SAP Learning Resources
        </p>
    </div>

</body>
</html>
