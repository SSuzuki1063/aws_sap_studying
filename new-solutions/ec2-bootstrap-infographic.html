<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EC2ブートストラップ入門ガイド</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        h1, h2, h3 {
            color: #0066cc;
            margin-top: 1.5em;
        }
        
        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 0.5em;
            border-bottom: 2px solid #0066cc;
            padding-bottom: 0.3em;
        }
        
        .intro {
            background-color: #e6f2ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 5px solid #0066cc;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .diagram {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            display: block;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .step {
            display: flex;
            margin-bottom: 30px;
            align-items: center;
        }
        
        .step-number {
            background-color: #0066cc;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            margin-right: 20px;
            flex-shrink: 0;
        }
        
        .step-content {
            flex-grow: 1;
        }
        
        .code-block {
            background-color: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
        }
        
        .highlight {
            color: #e06c75;
            font-weight: bold;
        }
        
        .note {
            background-color: #fff9e6;
            border-left: 4px solid #ffd700;
            padding: 10px 15px;
            margin: 15px 0;
        }
        
        .two-column {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }
        
        .column {
            flex: 1;
            min-width: 300px;
        }
        
        .aws-orange {
            color: #FF9900;
        }
        
        .aws-blue {
            color: #232F3E;
        }
        
        .footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #666;
        }
        
        .pros-cons {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        
        .pros, .cons {
            flex: 1;
            padding: 15px;
            border-radius: 8px;
        }
        
        .pros {
            background-color: #e6f7e6;
            border-left: 4px solid #4CAF50;
        }
        
        .cons {
            background-color: #ffebee;
            border-left: 4px solid #F44336;
        }
        
        @media (max-width: 768px) {
            .step {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .step-number {
                margin-bottom: 10px;
            }
            
            .pros-cons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <h1>EC2ブートストラップ入門ガイド</h1>
    
    <div class="intro">
        <h2>ブートストラップとは？</h2>
        <p>EC2インスタンスのブートストラップとは、インスタンスが起動する際に自動的に実行される初期設定プロセスのことです。これにより、インスタンス起動時に必要なソフトウェアのインストールやサービスの設定などを自動化できます。</p>
    </div>
    
    <div class="card">
        <h2>ブートストラップの全体像</h2>
        
        <svg class="diagram" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg">
            <!-- EC2インスタンス起動フロー図 -->
            <rect x="50" y="50" width="700" height="300" fill="#f5f5f5" stroke="#ddd" stroke-width="2" rx="10" />
            
            <!-- タイトル -->
            <text x="400" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#0066cc">EC2ブートストラッププロセス</text>
            
            <!-- 起動プロセス -->
            <rect x="100" y="100" width="120" height="60" fill="#FF9900" stroke="#232F3E" stroke-width="2" rx="5" />
            <text x="160" y="135" text-anchor="middle" font-size="14" fill="white">EC2インスタンス起動</text>
            
            <!-- ユーザーデータスクリプト -->
            <rect x="340" y="100" width="120" height="60" fill="#FF9900" stroke="#232F3E" stroke-width="2" rx="5" />
            <text x="400" y="135" text-anchor="middle" font-size="14" fill="white">ユーザーデータ実行</text>
            
            <!-- 完了状態 -->
            <rect x="580" y="100" width="120" height="60" fill="#FF9900" stroke="#232F3E" stroke-width="2" rx="5" />
            <text x="640" y="135" text-anchor="middle" font-size="14" fill="white">設定完了</text>
            
            <!-- フロー矢印 -->
            <line x1="220" y1="130" x2="340" y2="130" stroke="#232F3E" stroke-width="2" />
            <polygon points="330,125 340,130 330,135" fill="#232F3E" />
            
            <line x1="460" y1="130" x2="580" y2="130" stroke="#232F3E" stroke-width="2" />
            <polygon points="570,125 580,130 570,135" fill="#232F3E" />
            
            <!-- ユーザーデータの詳細 -->
            <rect x="290" y="200" width="220" height="120" fill="white" stroke="#ddd" stroke-width="2" rx="5" />
            <text x="400" y="220" text-anchor="middle" font-size="14" font-weight="bold">ユーザーデータ内容:</text>
            <text x="400" y="245" text-anchor="middle" font-size="12">• パッケージ更新・インストール</text>
            <text x="400" y="265" text-anchor="middle" font-size="12">• アプリケーションのデプロイ</text>
            <text x="400" y="285" text-anchor="middle" font-size="12">• 設定ファイルの配置</text>
            <text x="400" y="305" text-anchor="middle" font-size="12">• サービスの開始</text>
            
            <!-- 接続線 -->
            <line x1="400" y1="160" x2="400" y2="200" stroke="#ddd" stroke-width="2" stroke-dasharray="5,5" />
        </svg>
        
        <p>ブートストラップの主な目的は、インスタンス起動時に自動的に以下のタスクを実行することです：</p>
        <ul>
            <li>オペレーティングシステムの更新</li>
            <li>必要なソフトウェアパッケージのインストール</li>
            <li>アプリケーションコードのダウンロードとデプロイ</li>
            <li>サービスの設定と起動</li>
            <li>メタデータの設定やタグ付け</li>
        </ul>
    </div>
    
    <div class="card">
        <h2>ブートストラップの方法</h2>
        
        <div class="step">
            <div class="step-number">1</div>
            <div class="step-content">
                <h3>ユーザーデータの活用</h3>
                <p>EC2インスタンス起動時に「ユーザーデータ」としてシェルスクリプトやクラウドイニットなどの初期化コードを提供できます。</p>
                
                <div class="code-block">
                    #!/bin/bash<br>
                    # システム更新<br>
                    yum update -y<br><br>
                    
                    # Apacheウェブサーバーのインストール<br>
                    yum install -y httpd<br><br>
                    
                    # サービスの有効化と開始<br>
                    systemctl enable httpd<br>
                    systemctl start httpd<br><br>
                    
                    # シンプルなウェブページの作成<br>
                    echo "&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello from EC2&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;" > /var/www/html/index.html
                </div>
                
                <div class="note">
                    <p><strong>注意：</strong> ユーザーデータスクリプトは、デフォルトでrootユーザーとして実行されます。最大サイズは16KBまでです。</p>
                </div>
            </div>
        </div>
        
        <div class="step">
            <div class="step-number">2</div>
            <div class="step-content">
                <h3>ユーザーデータの指定方法</h3>
                <p>EC2インスタンス作成時に、以下の手順でユーザーデータを設定できます：</p>
                
                <ol>
                    <li>EC2ダッシュボードから「インスタンスの起動」を選択</li>
                    <li>AMI、インスタンスタイプなどを選択</li>
                    <li>「詳細設定」セクションを開く</li>
                    <li>「ユーザーデータ」テキストボックスにスクリプトを入力</li>
                </ol>
                
                <svg class="diagram" viewBox="0 0 600 200" xmlns="http://www.w3.org/2000/svg">
                    <!-- ユーザーデータ入力画面の模式図 -->
                    <rect x="50" y="30" width="500" height="150" fill="white" stroke="#ddd" stroke-width="2" rx="5" />
                    <text x="300" y="20" text-anchor="middle" font-size="16" font-weight="bold">EC2インスタンス作成画面</text>
                    
                    <rect x="70" y="50" width="460" height="30" fill="#f5f5f5" stroke="#ddd" stroke-width="1" />
                    <text x="100" y="70" font-size="14">詳細設定</text>
                    
                    <rect x="70" y="90" width="460" height="70" fill="white" stroke="#ddd" stroke-width="1" />
                    <text x="100" y="110" font-size="14" font-weight="bold">ユーザーデータ</text>
                    <rect x="90" y="120" width="420" height="30" fill="#f9f9f9" stroke="#ddd" stroke-width="1" rx="3" />
                    <text x="105" y="140" font-size="12" fill="#666">#!/bin/bash...</text>
                </svg>
            </div>
        </div>
    </div>
    
    <div class="card">
        <h2>ブートストラップの高度な方法</h2>
        
        <div class="two-column">
            <div class="column">
                <h3>CloudFormationの使用</h3>
                <p>AWSのCloudFormationテンプレートを使用して、より体系的なインフラストラクチャのプロビジョニングとEC2インスタンスのブートストラップを行うことができます。</p>
                
                <div class="code-block">
                    Resources:<br>
                    &nbsp;&nbsp;MyEC2Instance:<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;Type: AWS::EC2::Instance<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;Properties:<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ImageId: ami-12345678<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InstanceType: t2.micro<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UserData:<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fn::Base64: !Sub |<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#!/bin/bash -xe<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yum update -y<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yum install -y httpd<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;systemctl start httpd<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;systemctl enable httpd
                </div>
            </div>
            
            <div class="column">
                <h3>EC2 Image Builder</h3>
                <p>カスタムAMI（Amazon Machine Image）を作成し、ブートストラップの一部を事前に実行しておくことで、インスタンス起動時間を短縮できます。</p>
                
                <div class="note">
                    <p><strong>メリット：</strong> インスタンス起動が高速化され、複雑な設定を事前に組み込めます。</p>
                    <p><strong>活用例：</strong> 複数のインスタンスで同じ設定を繰り返し使用する場合に効果的です。</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card">
        <h2>ユースケース別ブートストラップサンプル</h2>
        
        <div class="step">
            <div class="step-number">A</div>
            <div class="step-content">
                <h3>Webサーバー構築</h3>
                <div class="code-block">
                    #!/bin/bash<br>
                    # Amazon Linux 2用Webサーバー構築スクリプト<br><br>
                    
                    # システム更新<br>
                    yum update -y<br><br>
                    
                    # Apacheインストール<br>
                    yum install -y httpd<br><br>
                    
                    # PHPインストール<br>
                    amazon-linux-extras install -y php7.4<br><br>
                    
                    # サービス開始<br>
                    systemctl start httpd<br>
                    systemctl enable httpd<br><br>
                    
                    # サンプルコンテンツ設置<br>
                    echo '&lt;?php phpinfo(); ?&gt;' > /var/www/html/info.php<br>
                    echo '&lt;html&gt;&lt;body&gt;&lt;h1&gt;サーバー準備完了！&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;' > /var/www/html/index.html
                </div>
            </div>
        </div>
        
        <div class="step">
            <div class="step-number">B</div>
            <div class="step-content">
                <h3>アプリケーションサーバー構築</h3>
                <div class="code-block">
                    #!/bin/bash<br>
                    # NodeJSアプリケーションサーバー構築スクリプト<br><br>
                    
                    # システム更新<br>
                    yum update -y<br><br>
                    
                    # Node.jsインストール<br>
                    curl -fsSL https://rpm.nodesource.com/setup_14.x | bash -<br>
                    yum install -y nodejs<br><br>
                    
                    # Gitインストール<br>
                    yum install -y git<br><br>
                    
                    # アプリケーションのクローン<br>
                    git clone https://github.com/example/node-app.git /opt/node-app<br><br>
                    
                    # 依存関係のインストール<br>
                    cd /opt/node-app<br>
                    npm install<br><br>
                    
                    # PM2でアプリケーション起動<br>
                    npm install -g pm2<br>
                    pm2 start app.js<br>
                    pm2 startup<br>
                    pm2 save
                </div>
            </div>
        </div>
    </div>
    
    <div class="card">
        <h2>ブートストラップのベストプラクティス</h2>
        
        <div class="pros-cons">
            <div class="pros">
                <h3>推奨事項</h3>
                <ul>
                    <li>スクリプトをモジュール化して再利用可能にする</li>
                    <li>エラーハンドリングを組み込む</li>
                    <li>ログを取得して診断を容易にする</li>
                    <li>セキュリティ更新を含める</li>
                    <li>S3やGitHubからスクリプトを取得する</li>
                </ul>
            </div>
            
            <div class="cons">
                <h3>避けるべきこと</h3>
                <ul>
                    <li>秘密情報をプレーンテキストで埋め込む</li>
                    <li>複雑すぎるスクリプトを作成する</li>
                    <li>エラー処理を省略する</li>
                    <li>起動時間を極端に長くする</li>
                    <li>信頼できないソースからスクリプトを実行する</li>
                </ul>
            </div>
        </div>
        
        <div class="note">
            <p><strong>TIP:</strong> Systems Manager Parameter StoreやSecretsManagerを活用して、スクリプト内に秘密情報を直接書き込まずに設定を管理できます。</p>
        </div>
        
        <h3>エラーハンドリングの例</h3>
        <div class="code-block">
            #!/bin/bash<br>
            # エラーハンドリング付きブートストラップスクリプト<br><br>
            
            # エラー発生時に終了するように設定<br>
            set -e<br><br>
            
            # ログファイルの設定<br>
            LOGFILE="/var/log/bootstrap.log"<br><br>
            
            # ログ関数<br>
            log() {<br>
            &nbsp;&nbsp;echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" | tee -a $LOGFILE<br>
            }<br><br>
            
            # エラーハンドラー<br>
            error_handler() {<br>
            &nbsp;&nbsp;log "エラーが発生しました: $1 ($2)"<br>
            &nbsp;&nbsp;exit 1<br>
            }<br><br>
            
            # エラーハンドラーを設定<br>
            trap 'error_handler "${BASH_COMMAND}" "$?"' ERR<br><br>
            
            # 開始ログ<br>
            log "ブートストラッププロセスを開始します"<br><br>
            
            # システム更新<br>
            log "システムの更新を開始します"<br>
            yum update -y<br>
            log "システムの更新が完了しました"<br><br>
            
            # 他のインストールと設定...<br>
            
            log "ブートストラッププロセスが正常に完了しました"
        </div>
    </div>
    
    <div class="card">
        <h2>ブートストラップのトラブルシューティング</h2>
        
        <h3>一般的な問題と解決策</h3>
        <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
            <tr style="background-color: #f0f0f0;">
                <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">問題</th>
                <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">考えられる原因</th>
                <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">解決策</th>
            </tr>
            <tr>
                <td style="border: 1px solid #ddd; padding: 10px;">スクリプトが実行されない</td>
                <td style="border: 1px solid #ddd; padding: 10px;">
                    • シバン（#!）の不足<br>
                    • 実行権限の問題<br>
                    • Base64エンコーディングの問題
                </td>
                <td style="border: 1px solid #ddd; padding: 10px;">
                    • スクリプトの先頭に #!/bin/bash を追加<br>
                    • ログを確認（/var/log/cloud-init-output.log）
                </td>
            </tr>
            <tr>
                <td style="border: 1px solid #ddd; padding: 10px;">スクリプトがエラーで終了</td>
                <td style="border: 1px solid #ddd; padding: 10px;">
                    • 依存関係の欠如<br>
                    • ネットワーク接続の問題<br>
                    • 構文エラー
                </td>
                <td style="border: 1px solid #ddd; padding: 10px;">
                    • エラーログを確認<br>
                    • 依存関係を事前インストール<br>
                    • スクリプトのテスト実行
                </td>
            </tr>
            <tr>
                <td style="border: 1px solid #ddd; padding: 10px;">起動時間が長すぎる</td>
                <td style="border: 1px solid #ddd; padding: 10px;">
                    • 重いパッケージのダウンロード<br>
                    • 非効率なスクリプト<br>
                    • リソース競合
                </td>
                <td style="border: 1px solid #ddd; padding: 10px;">
                    • AMIに事前インストール<br>
                    • 非同期処理の活用<br>
                    • スクリプトの最適化
                </td>
            </tr>
        </table>
        
        <div class="note">
            <p><strong>診断方法：</strong> EC2インスタンスに接続し、以下のログファイルを確認してブートストラッププロセスのトラブルシューティングを行えます：</p>
            <ul>
                <li>/var/log/cloud-init.log</li>
                <li>/var/log/cloud-init-output.log</li>
                <li>/var/log/user-data.log（カスタムログの場合）</li>
            </ul>
        </div>
    </div>
    
    <div class="card">
        <h2>まとめ</h2>
        <p>EC2ブートストラップを使うことで、インスタンス起動時に自動的に設定を行い、一貫性のあるインフラストラクチャを効率的に構築できます。ユーザーデータスクリプトは単純なものから始め、徐々に高度な手法に移行していくことで、AWSでのインフラ管理スキルを向上させることができます。</p>
        
        <div class="two-column">
            <div class="column">
                <h3>次のステップ</h3>
                <ul>
                    <li>独自のブートストラップスクリプトを作成してみる</li>
                    <li>CloudFormationやAWS CDKでインフラのコード化を試す</li>
                    <li>Systems ManagerやAnsibleなどの高度な設定管理ツールを学ぶ</li>
                </ul>
            </div>
            
            <div class="column">
                <h3>関連リソース</h3>
                <ul>
                    <li>AWS公式ドキュメント：「インスタンスユーザーデータ」</li>
                    <li>AWS CloudFormationテンプレートリファレンス</li>
                    <li>AWS Systems Manager ユーザーガイド</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>© 2025 EC2ブートストラップ入門ガイド</p>
    </div>
    <button style="position: fixed; bottom: 30px; right: 30px; background-color: #FF9900; color: white; border: none; padding: 15px 30px; border-radius: 50px; font-size: 1.1em; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(255, 153, 0, 0.3); transition: all 0.3s ease; z-index: 1000;" onclick="window.location.href='../index.html'" onmouseover="this.style.backgroundColor='#E68900'; this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 16px rgba(255, 153, 0, 0.4)';" onmouseout="this.style.backgroundColor='#FF9900'; this.style.transform='scale(1)'; this.style.boxShadow='0 4px 12px rgba(255, 153, 0, 0.3)';">🏠 ホームに戻る</button>


    <div style="text-align: center; padding: 20px; margin-top: 40px; border-top: 2px solid #E5E7EB; background-color: #F9FAFB;">
        <p style="color: #6B7280; font-size: 0.9em; margin: 0;">
            Created by <a href="https://github.com/SSuzuki1063" target="_blank" style="color: #FF9900; text-decoration: none; font-weight: 600;">SSuzuki1063</a>
        </p>
        <p style="color: #9CA3AF; font-size: 0.8em; margin: 5px 0 0 0;">
            AWS SAP Learning Resources
        </p>
    </div>

</body>
</html>