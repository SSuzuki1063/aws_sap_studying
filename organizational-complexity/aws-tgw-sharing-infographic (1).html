<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AWS Transit Gateway共有ガイド - リソースアクセスマネージャー活用法</title>
  <style>
    body {
      font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f8f9fa;
    }
    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: linear-gradient(135deg, #232f3e 0%, #527FFF 100%);
      color: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    h1 {
      margin: 0;
      font-size: 2.2em;
    }
    h2 {
      color: #232f3e;
      border-bottom: 2px solid #FF9900;
      padding-bottom: 8px;
      margin-top: 40px;
    }
    h3 {
      color: #527FFF;
      margin-top: 25px;
    }
    .intro {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      margin-bottom: 30px;
    }
    .section {
      background-color: white;
      padding: 25px;
      border-radius: 8px;
      margin-bottom: 30px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    .diagram {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      text-align: center;
    }
    .step-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin: 30px 0;
    }
    .step {
      flex: 1;
      min-width: 250px;
      background-color: #f1f8ff;
      border-left: 4px solid #527FFF;
      padding: 15px;
      border-radius: 0 8px 8px 0;
    }
    .step h4 {
      margin-top: 0;
      color: #232f3e;
    }
    .benefits {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin: 20px 0;
    }
    .benefit {
      flex: 1;
      min-width: 200px;
      background-color: #fff8e1;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    .icon {
      font-size: 24px;
      margin-bottom: 10px;
      color: #FF9900;
    }
    .note {
      background-color: #e8f5e9;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      border-left: 4px solid #4caf50;
    }
    .warning {
      background-color: #fff3e0;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      border-left: 4px solid #ff9800;
    }
    code {
      background-color: #f1f1f1;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: Consolas, Monaco, 'Andale Mono', monospace;
      font-size: 0.9em;
    }
    .highlight {
      background-color: #ffecb3;
      padding: 2px 4px;
      border-radius: 4px;
    }
    footer {
      text-align: center;
      margin-top: 50px;
      padding: 20px;
      color: #666;
      font-size: 0.9em;
    }
    .aws-color {
      color: #FF9900;
    }
    .image-caption {
      font-size: 0.9em;
      color: #666;
      margin-top: 10px;
      text-align: center;
    }
  </style>
</head>
<body>
  <header>
    <h1>AWS Transit Gatewayの複数アカウント共有ガイド</h1>
    <p>リソースアクセスマネージャー(RAM)を活用した簡単セットアップ</p>
  </header>

  <div class="intro">
    <h2>はじめに：Transit Gatewayとは？</h2>
    <p>AWS Transit Gateway（TGW）は、複数のVPC、AWS アカウント、オンプレミスネットワークを一箇所でまとめて接続できるネットワークハブです。従来のVPC間のピアリング接続と比較して、ネットワーク構成を大幅にシンプル化できます。</p>
    
    <div class="diagram">
      <svg width="700" height="300" viewBox="0 0 700 300">
        <!-- 背景 -->
        <rect x="0" y="0" width="700" height="300" fill="#f8f9fa" rx="10" ry="10"/>
        
        <!-- Transit Gateway -->
        <circle cx="350" cy="150" r="50" fill="#FF9900" stroke="#232f3e" stroke-width="2"/>
        <text x="350" y="155" text-anchor="middle" font-size="14" fill="#232f3e" font-weight="bold">Transit Gateway</text>
        
        <!-- VPC 1 -->
        <rect x="100" y="50" width="120" height="80" fill="#527FFF" stroke="#232f3e" stroke-width="2" rx="5" ry="5" opacity="0.7"/>
        <text x="160" y="90" text-anchor="middle" font-size="14" fill="white" font-weight="bold">VPC 1</text>
        <text x="160" y="110" text-anchor="middle" font-size="12" fill="white">アカウントA</text>
        
        <!-- VPC 2 -->
        <rect x="100" y="170" width="120" height="80" fill="#527FFF" stroke="#232f3e" stroke-width="2" rx="5" ry="5" opacity="0.7"/>
        <text x="160" y="210" text-anchor="middle" font-size="14" fill="white" font-weight="bold">VPC 2</text>
        <text x="160" y="230" text-anchor="middle" font-size="12" fill="white">アカウントA</text>
        
        <!-- VPC 3 -->
        <rect x="480" y="50" width="120" height="80" fill="#34A853" stroke="#232f3e" stroke-width="2" rx="5" ry="5" opacity="0.7"/>
        <text x="540" y="90" text-anchor="middle" font-size="14" fill="white" font-weight="bold">VPC 3</text>
        <text x="540" y="110" text-anchor="middle" font-size="12" fill="white">アカウントB</text>
        
        <!-- VPC 4 -->
        <rect x="480" y="170" width="120" height="80" fill="#34A853" stroke="#232f3e" stroke-width="2" rx="5" ry="5" opacity="0.7"/>
        <text x="540" y="210" text-anchor="middle" font-size="14" fill="white" font-weight="bold">VPC 4</text>
        <text x="540" y="230" text-anchor="middle" font-size="12" fill="white">アカウントB</text>
        
        <!-- 接続線 -->
        <line x1="220" y1="90" x2="300" y2="130" stroke="#232f3e" stroke-width="2"/>
        <line x1="220" y1="210" x2="300" y2="170" stroke="#232f3e" stroke-width="2"/>
        <line x1="400" y1="130" x2="480" y2="90" stroke="#232f3e" stroke-width="2"/>
        <line x1="400" y1="170" x2="480" y2="210" stroke="#232f3e" stroke-width="2"/>
        
        <!-- RAM説明 -->
        <rect x="280" y="250" width="140" height="40" fill="#FFCB2B" stroke="#232f3e" stroke-width="2" rx="5" ry="5" opacity="0.8"/>
        <text x="350" y="275" text-anchor="middle" font-size="12" fill="#232f3e" font-weight="bold">Resource Access Manager</text>
        
        <!-- RAM矢印 -->
        <line x1="350" y1="250" x2="350" y2="200" stroke="#232f3e" stroke-width="2" stroke-dasharray="5,5"/>
      </svg>
      <p class="image-caption">図1: Transit Gatewayによる複数アカウント間のVPC接続</p>
    </div>
  </div>

  <div class="section">
    <h2>なぜResource Access Manager（RAM）が必要なのか？</h2>
    <p>AWS環境では、セキュリティとコスト管理のために複数のAWSアカウントを使うことが一般的です。しかし、アカウントをまたいだリソース共有には特別な仕組みが必要です。</p>
    <p>ここで活躍するのが<span class="highlight">AWS Resource Access Manager（RAM）</span>です。RAMを使うことで、Transit Gatewayのような特定のAWSリソースを複数のアカウントで安全に共有できます。</p>
    
    <div class="benefits">
      <div class="benefit">
        <div class="icon">🔄</div>
        <h4>一元管理</h4>
        <p>すべてのネットワーク接続を一箇所で管理</p>
      </div>
      <div class="benefit">
        <div class="icon">💰</div>
        <h4>コスト削減</h4>
        <p>Transit Gatewayを複数で共有しコスト効率化</p>
      </div>
      <div class="benefit">
        <div class="icon">🔒</div>
        <h4>セキュリティ強化</h4>
        <p>アクセス権限を細かく制御</p>
      </div>
    </div>
  </div>

  <div class="section">
    <h2>Transit Gatewayを共有するための手順</h2>
    
    <div class="diagram">
      <svg width="700" height="500" viewBox="0 0 700 500">
        <!-- 背景 -->
        <rect x="0" y="0" width="700" height="500" fill="#f8f9fa" rx="10" ry="10"/>
        
        <!-- 左側アカウント（所有者） -->
        <rect x="50" y="50" width="250" height="400" fill="#e1f5fe" stroke="#232f3e" stroke-width="2" rx="10" ry="10"/>
        <text x="175" y="80" text-anchor="middle" font-size="16" fill="#232f3e" font-weight="bold">アカウントA（所有者）</text>
        
        <!-- Transit Gateway -->
        <rect x="100" y="120" width="150" height="100" fill="#FF9900" stroke="#232f3e" stroke-width="2" rx="8" ry="8" opacity="0.8"/>
        <text x="175" y="175" text-anchor="middle" font-size="14" fill="#232f3e" font-weight="bold">Transit Gateway</text>
        
        <!-- RAM -->
        <rect x="100" y="250" width="150" height="100" fill="#FFCB2B" stroke="#232f3e" stroke-width="2" rx="8" ry="8" opacity="0.8"/>
        <text x="175" y="280" text-anchor="middle" font-size="14" fill="#232f3e" font-weight="bold">Resource Access</text>
        <text x="175" y="300" text-anchor="middle" font-size="14" fill="#232f3e" font-weight="bold">Manager (RAM)</text>
        <text x="175" y="330" text-anchor="middle" font-size="12" fill="#232f3e">リソース共有作成</text>
        
        <!-- 右側アカウント（共有先） -->
        <rect x="400" y="50" width="250" height="400" fill="#e8f5e9" stroke="#232f3e" stroke-width="2" rx="10" ry="10"/>
        <text x="525" y="80" text-anchor="middle" font-size="16" fill="#232f3e" font-weight="bold">アカウントB（共有先）</text>
        
        <!-- 招待/承認 -->
        <rect x="450" y="190" width="150" height="60" fill="#a5d6a7" stroke="#232f3e" stroke-width="2" rx="8" ry="8" opacity="0.8"/>
        <text x="525" y="225" text-anchor="middle" font-size="14" fill="#232f3e" font-weight="bold">共有招待を承認</text>
        
        <!-- VPC接続 -->
        <rect x="450" y="280" width="150" height="100" fill="#81c784" stroke="#232f3e" stroke-width="2" rx="8" ry="8" opacity="0.8"/>
        <text x="525" y="320" text-anchor="middle" font-size="14" fill="#232f3e" font-weight="bold">VPCをTransit</text>
        <text x="525" y="340" text-anchor="middle" font-size="14" fill="#232f3e" font-weight="bold">Gatewayに接続</text>
        
        <!-- 共有の矢印 -->
        <path d="M250,290 Q350,290 450,220" fill="none" stroke="#232f3e" stroke-width="3" stroke-dasharray="10,5"/>
        <polygon points="445,218 455,220 445,222" fill="#232f3e"/>
        
        <!-- 接続の矢印 -->
        <path d="M250,170 Q400,100 450,170" fill="none" stroke="#232f3e" stroke-width="3"/>
        <path d="M450,330 Q400,400 250,330" fill="none" stroke="#232f3e" stroke-width="3"/>
        <polygon points="245,328 255,330 245,332" fill="#232f3e"/>
        
        <!-- ステップ表示 -->
        <circle cx="250" cy="290" r="15" fill="#232f3e" stroke="white" stroke-width="1"/>
        <text x="250" y="295" text-anchor="middle" font-size="14" fill="white" font-weight="bold">1</text>
        
        <circle cx="450" cy="220" r="15" fill="#232f3e" stroke="white" stroke-width="1"/>
        <text x="450" y="225" text-anchor="middle" font-size="14" fill="white" font-weight="bold">2</text>
        
        <circle cx="450" cy="330" r="15" fill="#232f3e" stroke="white" stroke-width="1"/>
        <text x="450" y="335" text-anchor="middle" font-size="14" fill="white" font-weight="bold">3</text>
      </svg>
      <p class="image-caption">図2: Resource Access Managerを使ったTransit Gateway共有プロセス</p>
    </div>

    <h3>ステップバイステップガイド</h3>
    <div class="step-container">
      <div class="step">
        <h4>ステップ1: Transit Gatewayの作成（アカウントA）</h4>
        <p>まず、所有者アカウント（アカウントA）でTransit Gatewayを作成します：</p>
        <ul>
          <li>AWSコンソールでVPCサービスを開く</li>
          <li>「Transit Gateways」を選択</li>
          <li>「Create Transit Gateway」をクリック</li>
          <li>名前、説明を入力し、必要に応じてオプションを設定</li>
          <li>「作成」をクリック</li>
        </ul>
      </div>
      
      <div class="step">
        <h4>ステップ2: RAMでリソース共有を作成（アカウントA）</h4>
        <p>次に、同じアカウントAでRAMを使ってリソース共有を設定します：</p>
        <ul>
          <li>AWSコンソールで「Resource Access Manager」を開く</li>
          <li>「Create resource share」をクリック</li>
          <li>共有の名前を入力</li>
          <li>リソースタイプとして「Transit Gateways」を選択</li>
          <li>共有するTransit Gatewayを選択</li>
          <li>「次へ」をクリック</li>
        </ul>
      </div>
      
      <div class="step">
        <h4>ステップ3: 共有先の設定（アカウントA）</h4>
        <p>Transit Gatewayを共有するアカウントを指定します：</p>
        <ul>
          <li>「許可」セクションで「AWSアカウント」を選択</li>
          <li>共有先のAWSアカウントID（アカウントB）を入力</li>
          <li>または、組織全体と共有する場合は組織IDを選択</li>
          <li>「共有」をクリック</li>
        </ul>
        <p>これで招待が共有先アカウントに送信されます</p>
      </div>

      <div class="step">
        <h4>ステップ4: 共有の受け入れ（アカウントB）</h4>
        <p>共有先アカウント（アカウントB）で共有を承認します：</p>
        <ul>
          <li>アカウントBでAWSコンソールにログイン</li>
          <li>「Resource Access Manager」を開く</li>
          <li>「共有リソース」タブを選択</li>
          <li>届いた共有招待を確認し「承諾」をクリック</li>
        </ul>
      </div>
    </div>

    <div class="note">
      <strong>重要：</strong> AWS組織内でアカウント間共有を行う場合、RAMの設定で「組織内の共有を有効にする」オプションをオンにすると、招待の承認ステップを省略できます。
    </div>
  </div>

  <div class="section">
    <h2>Transit Gateway Attachmentの作成</h2>
    <p>共有されたTransit Gatewayに各アカウントのVPCを接続するには、Transit Gateway Attachmentを作成する必要があります。</p>
    
    <div class="diagram">
      <svg width="700" height="350" viewBox="0 0 700 350">
        <!-- 背景 -->
        <rect x="0" y="0" width="700" height="350" fill="#f8f9fa" rx="10" ry="10"/>
        
        <!-- Transit Gateway（中央） -->
        <circle cx="350" cy="175" r="60" fill="#FF9900" stroke="#232f3e" stroke-width="2"/>
        <text x="350" y="175" text-anchor="middle" font-size="14" fill="#232f3e" font-weight="bold">Transit</text>
        <text x="350" y="195" text-anchor="middle" font-size="14" fill="#232f3e" font-weight="bold">Gateway</text>
        
        <!-- アカウントA（所有者） -->
        <rect x="50" y="50" width="200" height="250" fill="#e1f5fe" stroke="#232f3e" stroke-width="2" rx="10" ry="10"/>
        <text x="150" y="80" text-anchor="middle" font-size="16" fill="#232f3e" font-weight="bold">アカウントA（所有者）</text>
        
        <!-- アカウントAのVPC -->
        <rect x="80" y="110" width="140" height="70" fill="#527FFF" stroke="#232f3e" stroke-width="2" rx="5" ry="5" opacity="0.7"/>
        <text x="150" y="150" text-anchor="middle" font-size="14" fill="white" font-weight="bold">VPC-A1</text>
        
        <rect x="80" y="200" width="140" height="70" fill="#527FFF" stroke="#232f3e" stroke-width="2" rx="5" ry="5" opacity="0.7"/>
        <text x="150" y="240" text-anchor="middle" font-size="14" fill="white" font-weight="bold">VPC-A2</text>
        
        <!-- アカウントB（共有先） -->
        <rect x="450" y="50" width="200" height="250" fill="#e8f5e9" stroke="#232f3e" stroke-width="2" rx="10" ry="10"/>
        <text x="550" y="80" text-anchor="middle" font-size="16" fill="#232f3e" font-weight="bold">アカウントB（共有先）</text>
        
        <!-- アカウントBのVPC -->
        <rect x="480" y="110" width="140" height="70" fill="#34A853" stroke="#232f3e" stroke-width="2" rx="5" ry="5" opacity="0.7"/>
        <text x="550" y="150" text-anchor="middle" font-size="14" fill="white" font-weight="bold">VPC-B1</text>
        
        <rect x="480" y="200" width="140" height="70" fill="#34A853" stroke="#232f3e" stroke-width="2" rx="5" ry="5" opacity="0.7"/>
        <text x="550" y="240" text-anchor="middle" font-size="14" fill="white" font-weight="bold">VPC-B2</text>
        
        <!-- アタッチメント線 -->
        <line x1="220" y1="145" x2="290" y2="175" stroke="#232f3e" stroke-width="2"/>
        <text x="255" y="150" text-anchor="middle" font-size="10" fill="#232f3e" font-weight="bold">Attachment</text>
        
        <line x1="220" y1="235" x2="290" y2="175" stroke="#232f3e" stroke-width="2"/>
        <text x="255" y="215" text-anchor="middle" font-size="10" fill="#232f3e" font-weight="bold">Attachment</text>
        
        <line x1="480" y1="145" x2="410" y2="175" stroke="#232f3e" stroke-width="2"/>
        <text x="445" y="150" text-anchor="middle" font-size="10" fill="#232f3e" font-weight="bold">Attachment</text>
        
        <line x1="480" y1="235" x2="410" y2="175" stroke="#232f3e" stroke-width="2"/>
        <text x="445" y="215" text-anchor="middle" font-size="10" fill="#232f3e" font-weight="bold">Attachment</text>
      </svg>
      <p class="image-caption">図3: 各アカウントからのTransit Gateway Attachment</p>
    </div>

    <h3>各アカウントでのAttachment作成手順</h3>
    <div class="step-container">
      <div class="step">
        <h4>所有者アカウント（アカウントA）</h4>
        <p>アカウントAでは、通常通りTransit Gateway Attachmentを作成できます：</p>
        <ol>
          <li>VPCサービスコンソールを開く</li>
          <li>「Transit Gateway Attachments」を選択</li>
          <li>「Create Transit Gateway Attachment」をクリック</li>
          <li>Transit Gatewayを選択</li>
          <li>接続するVPCを選択</li>
          <li>サブネットを選択</li>
          <li>「作成」をクリック</li>
        </ol>
      </div>
      
      <div class="step">
        <h4>共有先アカウント（アカウントB）</h4>
        <p>アカウントBでは、共有されたTransit Gatewayを使ってAttachmentを作成します：</p>
        <ol>
          <li>VPCサービスコンソールを開く</li>
          <li>「Transit Gateway Attachments」を選択</li>
          <li>「Create Transit Gateway Attachment」をクリック</li>
          <li>共有されているTransit Gatewayを選択（自動的に表示されます）</li>
          <li>接続するVPCを選択</li>
          <li>サブネットを選択</li>
          <li>「作成」をクリック</li>
        </ol>
      </div>
    </div>

    <div class="warning">
      <strong>注意：</strong> Transit Gateway Attachmentを作成するには、各VPCに少なくとも1つのサブネットが必要です。また、接続するサブネットは各アベイラビリティゾーンで選択する必要があります。
    </div>
  </div>

  <div class="section">
    <h2>ルーティング設定</h2>
    <p>Transit Gatewayを介して各VPC間で通信できるようにするには、適切なルーティング設定が必要です。</p>
    
    <div class="diagram">
      <svg width="700" height="300" viewBox="0 0 700 300">
        <!-- 背景 -->
        <rect x="0" y="0" width="700" height="300" fill="#f8f9fa" rx="10" ry="10"/>
        
        <!-- Transit Gateway（中央） -->
        <rect x="250" y="110" width="200" height="80" fill="#FF9900" stroke="#232f3e" stroke-width="2" rx="5" ry="5"/>
        <text x="350" y="145" text-anchor="middle" font-size="14" fill="#232f3e" font-weight="bold">Transit Gateway</text>
        <text x="350" y="165" text-anchor="middle" font-size="14" fill="#232f3e" font-weight="bold">ルートテーブル</text>
        
        <!-- VPC 1 ルートテーブル -->
        <rect x="50" y="50" width="150" height="80" fill="#527FFF" stroke="#232f3e" stroke-width="2" rx="5" ry="5" opacity="0.7"/>
        <text x="125" y="80" text-anchor="middle" font-size="14" fill="white" font-weight="bold">VPC-A ルートテーブル</text>
        <text x="125" y="100" text-anchor="middle" font-size="12" fill="white">10.2.0.0/16 → TGW</text>
        
        <!-- VPC 2 ルートテーブル -->
        <rect x="500" y="50" width="150" height="80" fill="#34A853" stroke="#232f3e" stroke-width="2" rx="5" ry="5" opacity="0.7"/>
        <text x="575" y="80" text-anchor="middle" font-size="14" fill="white" font-weight="bold">VPC-B ルートテーブル</text>
        <text x="575" y="100" text-anchor="middle" font-size="12" fill="white">10.1.0.0/16 → TGW</text>
        
        <!-- 接続線 -->
        <line x1="200" y1="90" x2="250" y2="140" stroke="#232f3e" stroke-width="2"/>
        <line x1="500" y1="90" x2="450" y2="140" stroke="#232f3e" stroke-width="2"/>
        
        <!-- CIDR情報 -->
        <rect x="50" y="170" width="150" height="40" fill="#e1f5fe" stroke="#232f3e" stroke-width="1" rx="5" ry="5"/>
        <text x="125" y="195" text-anchor="middle" font-size="14" fill="#232f3e">VPC-A: 10.1.0.0/16</text>
        
        <rect x="500" y="170" width="150" height="40" fill="#e8f5e9" stroke="#232f3e" stroke-width="1" rx="5" ry="5"/>
        <text x="575" y="195" text-anchor="middle" font-size="14" fill="#232f3e">VPC-B: 10.2.0.0/16</text>
        
        <!-- TGW ルートテーブル説明 -->
        <rect x="275" y="220" width="150" height="60" fill="#fff8dc" stroke="#232f3e" stroke-width="1" rx="5" ry="5"/>
        <text x="350" y="245" text-anchor="middle" font-size="12" fill="#232f3e">宛先: すべてのVPC</text>
        <text x="350" y="265" text-anchor="middle" font-size="12" fill="#232f3e">ターゲット: 各Attachment</text>
      </svg>
      <p class="image-caption">図4: Transit Gatewayのルーティング設定</p>
    </div>
    
    <h3>ルーティング設定の手順</h3>
    
    <div class="step-container">
      <div class="step">
        <h4>ステップ1: Transit Gatewayルートテーブルの設定（アカウントA）</h4>
        <p>Transit Gateway所有者が中央のルートテーブルを設定します：</p>
        <ol>
          <li>Transit Gateway Route Tablesに移動</li>
          <li>「Create Transit Gateway Route Table」をクリック</li>
          <li>Transit Gatewayを選択</li>
          <li>名前を入力して作成</li>
          <li>作成したルートテーブルを選択</li>
          <li>「アソシエーション」タブで「アソシエーションの作成」</li>
          <li>すべてのAttachmentを選択してアソシエーション</li>
          <li>「伝播」タブで「伝播の作成」</li>
          <li>すべてのAttachmentを選択して伝播を有効化</li>
        </ol>
      </div>
      
      <div class="step">
        <h4>ステップ2: VPCルートテーブルの設定（両アカウント）</h4>
        <p>各VPCのルートテーブルに相手側のCIDRを追加します：</p>
        <ol>
          <li>VPCサービスの「Route Tables」に移動</li>
          <li>対象VPCのルートテーブルを選択</li>
          <li>「Routes」タブで「Edit routes」をクリック</li>
          <li>「Add route」をクリック</li>
          <li>宛先に相手VPCのCIDRを入力（例: 10.2.0.0/16）</li>
          <li>ターゲットとしてTransit Gatewayを選択</li>
          <li>「変更を保存」をクリック</li>
        </ol>
        <p>※ アカウントA・Bの両方でこの手順を実行</p>
      </div>
    </div>
    
    <div class="note">
      <strong>自動伝播について：</strong> Transit Gatewayで「Route Table Propagation」を有効にすると、接続されたVPCのCIDRが自動的にTransit Gatewayのルートテーブルに追加されます。しかし、各VPCのルートテーブルには手動で相手側のCIDRを追加する必要があります。
    </div>
  </div>
  
  <div class="section">
    <h2>セキュリティとネットワークACL設定</h2>
    <p>異なるアカウント間のVPC通信を許可するには、セキュリティグループとネットワークACLの設定も確認する必要があります。</p>
    
    <div class="step-container">
      <div class="step">
        <h4>セキュリティグループの設定</h4>
        <p>各VPCのEC2インスタンスなどに適用されているセキュリティグループで、相手側VPCからのトラフィックを許可する必要があります：</p>
        <ul>
          <li>VPCコンソールの「Security Groups」に移動</li>
          <li>対象のセキュリティグループを選択</li>
          <li>「Inbound Rules」タブで「Edit inbound rules」をクリック</li>
          <li>新しいルールを追加し、相手VPCのCIDRからの必要なプロトコル/ポートを許可</li>
          <li>例: アカウントAのVPC (10.1.0.0/16)からアカウントBのVPC (10.2.0.0/16)のDBポートへのアクセス</li>
        </ul>
      </div>
      
      <div class="step">
        <h4>ネットワークACLの確認</h4>
        <p>デフォルトのネットワークACLは通常すべてのトラフィックを許可していますが、カスタム設定がある場合は確認が必要です：</p>
        <ul>
          <li>VPCコンソールの「Network ACLs」に移動</li>
          <li>対象のサブネットに関連付けられたACLを選択</li>
          <li>「Inbound Rules」と「Outbound Rules」タブで相手VPCのCIDRがブロックされていないか確認</li>
          <li>必要に応じて新しいルールを追加し、相手VPCのCIDRとの通信を許可</li>
        </ul>
      </div>
    </div>
    
    <div class="warning">
      <strong>セキュリティのベストプラクティス：</strong> すべてのトラフィックを許可するのではなく、本当に必要なポートとプロトコルのみを許可するように設定してください。特に本番環境では最小権限の原則に従うことが重要です。
    </div>
  </div>
  
  <div class="section">
    <h2>コスト管理と考慮事項</h2>
    
    <div class="benefits">
      <div class="benefit">
        <div class="icon">💰</div>
        <h4>アタッチメント料金</h4>
        <p>Transit Gateway Attachmentごとに時間単位の料金が発生します。各アカウントは自身のアタッチメントに対する料金を支払います。</p>
      </div>
      <div class="benefit">
        <div class="icon">📊</div>
        <h4>データ転送料金</h4>
        <p>VPC間のデータ転送には料金が発生します。トラフィックパターンを把握し、コスト最適化を検討しましょう。</p>
      </div>
      <div class="benefit">
        <div class="icon">⚙️</div>
        <h4>共有の最適化</h4>
        <p>AWS Organizations内でRAMを使用する場合、招待・承認プロセスを省略できます。大規模な環境では効率化が可能です。</p>
      </div>
    </div>
    
    <div class="note">
      <strong>コスト削減のヒント：</strong> 複数のTransit Gatewayを作成するよりも、1つのTransit Gatewayを共有するほうがコスト効率が高くなります。また、インターリージョン通信が必要ない場合は、同じリージョン内でのみ共有することでコストを抑えられます。
    </div>
  </div>

  <div class="section">
    <h2>まとめ：Transit Gateway共有の全体像</h2>
    
    <div class="diagram">
      <svg width="700" height="350" viewBox="0 0 700 350">
        <!-- 背景 -->
        <rect x="0" y="0" width="700" height="350" fill="#f8f9fa" rx="10" ry="10"/>
        
        <!-- AWS クラウド -->
        <rect x="50" y="30" width="600" height="290" fill="#232f3e" stroke="#232f3e" stroke-width="2" rx="10" ry="10" opacity="0.1"/>
        <text x="100" y="60" font-size="16" fill="#232f3e" font-weight="bold">AWS クラウド</text>
        
        <!-- アカウントA（所有者） -->
        <rect x="80" y="80" width="240" height="220" fill="#e1f5fe" stroke="#232f3e" stroke-width="2" rx="10" ry="10"/>
        <text x="200" y="105" text-anchor="middle" font-size="14" fill="#232f3e" font-weight="bold">アカウントA（所有者）</text>
        
        <!-- アカウントB（共有先） -->
        <rect x="380" y="80" width="240" height="220" fill="#e8f5e9" stroke="#232f3e" stroke-width="2" rx="10" ry="10"/>
        <text x="500" y="105" text-anchor="middle" font-size="14" fill="#232f3e" font-weight="bold">アカウントB（共有先）</text>
        
        <!-- Transit Gateway -->
        <circle cx="200" cy="170" r="35" fill="#FF9900" stroke="#232f3e" stroke-width="2"/>
        <text x="200" y="170" text-anchor="middle" font-size="12" fill="#232f3e" font-weight="bold">Transit</text>
        <text x="200" y="185" text-anchor="middle" font-size="12" fill="#232f3e" font-weight="bold">Gateway</text>
        
        <!-- RAM -->
        <rect x="170" y="230" width="60" height="30" fill="#FFCB2B" stroke="#232f3e" stroke-width="1" rx="5" ry="5"/>
        <text x="200" y="250" text-anchor="middle" font-size="10" fill="#232f3e" font-weight="bold">RAM</text>
        
        <!-- VPC A -->
        <rect x="100" y="130" width="60" height="40" fill="#527FFF" stroke="#232f3e" stroke-width="1" rx="5" ry="5" opacity="0.7"/>
        <text x="130" y="155" text-anchor="middle" font-size="10" fill="white" font-weight="bold">VPC-A1</text>
        
        <!-- VPC B -->
        <rect x="100" y="180" width="60" height="40" fill="#527FFF" stroke="#232f3e" stroke-width="1" rx="5" ry="5" opacity="0.7"/>
        <text x="130" y="205" text-anchor="middle" font-size="10" fill="white" font-weight="bold">VPC-A2</text>
        
        <!-- VPC C -->
        <rect x="480" y="130" width="60" height="40" fill="#34A853" stroke="#232f3e" stroke-width="1" rx="5" ry="5" opacity="0.7"/>
        <text x="510" y="155" text-anchor="middle" font-size="10" fill="white" font-weight="bold">VPC-B1</text>
        
        <!-- VPC D -->
        <rect x="480" y="180" width="60" height="40" fill="#34A853" stroke="#232f3e" stroke-width="1" rx="5" ry="5" opacity="0.7"/>
        <text x="510" y="205" text-anchor="middle" font-size="10" fill="white" font-weight="bold">VPC-B2</text>
        
        <!-- 接続線 -->
        <line x1="160" y1="150" x2="180" y2="155" stroke="#232f3e" stroke-width="1.5"/>
        <line x1="160" y1="200" x2="180" y2="185" stroke="#232f3e" stroke-width="1.5"/>
        
        <!-- 共有線 -->
        <path d="M235,170 Q350,170 430,150" fill="none" stroke="#FF9900" stroke-width="2" stroke-dasharray="5,3"/>
        <path d="M235,170 Q350,200 430,200" fill="none" stroke="#FF9900" stroke-width="2" stroke-dasharray="5,3"/>
        
        <!-- RAM共有 -->
        <path d="M200,230 Q350,280 500,230" fill="none" stroke="#FFCB2B" stroke-width="2" stroke-dasharray="5,3"/>
        <text x="350" y="300" text-anchor="middle" font-size="10" fill="#232f3e">リソース共有</text>
        
        <!-- ルート伝播 -->
        <text x="350" y="140" text-anchor="middle" font-size="10" fill="#232f3e">ルーティング情報の伝播</text>
      </svg>
      <p class="image-caption">図5: Transit Gateway共有の全体アーキテクチャ</p>
    </div>
    
    <h3>実装のキーポイント</h3>
    <ol>
      <li><strong>所有者アカウント（アカウントA）</strong> でTransit Gatewayを作成</li>
      <li>Resource Access Manager（RAM）を使用して他のアカウントとTransit Gatewayを共有</li>
      <li><strong>共有先アカウント（アカウントB）</strong> で共有招待を承認（AWS Organizations内の場合は不要）</li>
      <li>両方のアカウントでTransit Gateway Attachmentを作成し、各自のVPCを接続</li>
      <li>Transit Gatewayのルートテーブルでルートの伝播を設定</li>
      <li>各VPCのルートテーブルで相手側VPCへのルートを追加</li>
      <li>セキュリティグループとネットワークACLを適切に設定</li>
    </ol>
    
    <div class="note">
      <strong>最後に：</strong> Transit Gatewayは、複数アカウントにまたがる複雑なネットワークアーキテクチャを大幅に簡素化します。リソースアクセスマネージャーと組み合わせることで、アカウント間の安全で効率的な接続を実現できます。初めて設定する場合は、まず小規模な検証環境で試すことをお勧めします。
    </div>
  </div>

  <footer>
    <p>AWS Resource Access Manager (RAM) と Transit Gateway の詳細については <a href="https://docs.aws.amazon.com/ram/latest/userguide/what-is.html" target="_blank">AWS公式ドキュメント</a> を参照してください。</p>
    <p>作成日: 2025年4月13日</p>
  </footer>
    <button style="position: fixed; bottom: 30px; right: 30px; background-color: #FF9900; color: white; border: none; padding: 15px 30px; border-radius: 50px; font-size: 1.1em; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(255, 153, 0, 0.3); transition: all 0.3s ease; z-index: 1000;" onclick="window.location.href='../index.html'" onmouseover="this.style.backgroundColor='#E68900'; this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 16px rgba(255, 153, 0, 0.4)';" onmouseout="this.style.backgroundColor='#FF9900'; this.style.transform='scale(1)'; this.style.boxShadow='0 4px 12px rgba(255, 153, 0, 0.3)';">🏠 ホームに戻る</button>


    <div style="text-align: center; padding: 20px; margin-top: 40px; border-top: 2px solid #E5E7EB; background-color: #F9FAFB;">
        <p style="color: #6B7280; font-size: 0.9em; margin: 0;">
            Created by <a href="https://github.com/suzuki100603" target="_blank" style="color: #FF9900; text-decoration: none; font-weight: 600;">suzuki100603</a>
        </p>
        <p style="color: #9CA3AF; font-size: 0.8em; margin: 5px 0 0 0;">
            AWS SAP Learning Resources
        </p>
    </div>

</body>
</html>