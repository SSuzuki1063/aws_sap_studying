<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS IAM フェデレーション入門</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 0;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #f7b801);
        }

        .section-title {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: white;
        }

        .analogy-box {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #ff6b6b;
        }

        .analogy-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #d63031;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .diagram {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 25px 0;
            text-align: center;
            position: relative;
        }

        .flow-step {
            display: inline-block;
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            min-width: 200px;
            position: relative;
            border: 2px solid #ddd;
        }

        .flow-step.user { border-color: #3498db; background: linear-gradient(135deg, #74b9ff, #0984e3); color: white; }
        .flow-step.idp { border-color: #e17055; background: linear-gradient(135deg, #fd79a8, #e84393); color: white; }
        .flow-step.aws { border-color: #00b894; background: linear-gradient(135deg, #55efc4, #00b894); color: white; }

        .arrow {
            display: inline-block;
            width: 40px;
            height: 20px;
            background: #95a5a6;
            margin: 0 10px;
            position: relative;
            vertical-align: middle;
        }

        .arrow::after {
            content: '';
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid #95a5a6;
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
        }

        .key-points {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .key-point {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 2px solid #ddd;
            transition: transform 0.3s ease;
        }

        .key-point:hover {
            transform: translateY(-5px);
        }

        .key-point h3 {
            color: #2d3436;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .big-diagram {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .entity {
            display: inline-block;
            padding: 20px;
            margin: 15px;
            border-radius: 15px;
            font-weight: bold;
            color: white;
            min-width: 150px;
            text-align: center;
            position: relative;
        }

        .entity.user { background: linear-gradient(135deg, #74b9ff, #0984e3); }
        .entity.company { background: linear-gradient(135deg, #fd79a8, #e84393); }
        .entity.aws { background: linear-gradient(135deg, #55efc4, #00b894); }

        .connection {
            stroke: #2d3436;
            stroke-width: 3;
            marker-end: url(#arrowhead);
        }

        .step-number {
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }

        .highlight {
            background: linear-gradient(120deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 3px 8px;
            border-radius: 5px;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2em; }
            .section { padding: 20px; }
            .section-title { font-size: 1.8em; }
            .flow-step { min-width: 150px; margin: 5px; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    
        

    
        /* ブレッドクラムナビゲーション */
        .breadcrumb-nav {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            font-size: 0.95em;
        }

        .breadcrumb-home {
            color: #FF9900;
            text-decoration: none;
            font-weight: 600;
            transition: opacity 0.3s ease;
        }

        .breadcrumb-home:hover {
            opacity: 0.7;
        }

        .breadcrumb-separator {
            color: #9CA3AF;
            user-select: none;
        }

        .breadcrumb-item {
            color: #374151;
            font-weight: 500;
        }

        .breadcrumb-current {
            color: #FF9900;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            .breadcrumb-nav {
                font-size: 0.85em;
                padding: 12px 18px;
            }
        }

    </style>
</head>
<body>
    <div class="container">
        
    
    <!-- ブレッドクラムナビゲーション -->
    <nav class="breadcrumb-nav">
        <a href="../index.html" class="breadcrumb-home">🏠 ホーム</a>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item">セキュリティ・ガバナンス</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-item">IAM & 認証・認可</span>
        <span class="breadcrumb-separator">›</span>
        <span class="breadcrumb-current">Iam Federation Infographic</span>
    </nav>
<div class="header">
            <h1>🔐 AWS IAM フェデレーション入門</h1>

<!-- ページ内目次 -->
<div id="toc-container" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-left: 4px solid #3b82f6; padding: 20px 25px; margin: 30px 0; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; cursor: pointer;" onclick="toggleTOC()">
        <h2 style="color: #1e40af; margin: 0; font-size: 1.3em; display: flex; align-items: center;">
            <span style="margin-right: 10px;">📑</span>
            <span>目次</span>
        </h2>
        <button id="toc-toggle-btn" style="background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.9em; transition: all 0.3s;">
            <span id="toc-toggle-icon">▼</span> <span id="toc-toggle-text">折りたたむ</span>
        </button>
    </div>
    <nav id="toc-content" style="transition: all 0.3s ease;">
        <ul style="list-style: none; padding: 0; margin: 0;">
            <li class="toc-h2"><a href="#IAMとは？">🏢
                IAMとは？</a></li>
            <li class="toc-h3"><a href="#身元確認">🔍 身元確認</a></li>
            <li class="toc-h3"><a href="#️-アクセス制御">🛡️ アクセス制御</a></li>
            <li class="toc-h3"><a href="#一元管理">📊 一元管理</a></li>
            <li class="toc-h2"><a href="#️-IdPIdentity-Providerとは？">🏛️
                IdP（Identity Provider）とは？</a></li>
            <li class="toc-h3"><a href="#認証の専門家">🔐 認証の専門家</a></li>
            <li class="toc-h3"><a href="#信頼関係">🤝 信頼関係</a></li>
            <li class="toc-h2"><a href="#SAML-2.0とは？">📜
                SAML 2.0とは？</a></li>
            <li class="toc-h3"><a href="#SAMLトークンの中身">SAMLトークンの中身</a></li>
            <li class="toc-h3"><a href="#標準プロトコル">🌐 標準プロトコル</a></li>
            <li class="toc-h3"><a href="#セキュア">🔒 セキュア</a></li>
            <li class="toc-h3"><a href="#⚡-効率的">⚡ 効率的</a></li>
            <li class="toc-h2"><a href="#フェデレーションとは？">🔗
                フェデレーションとは？</a></li>
            <li class="toc-h3"><a href="#フェデレーションの仕組み">フェデレーションの仕組み</a></li>
            <li class="toc-h2"><a href="#SSOシングルサインオンとは？">🔑
                SSO（シングルサインオン）とは？</a></li>
            <li class="toc-h3"><a href="#SSO-の利点">SSO の利点</a></li>
            <li class="toc-h3"><a href="#ユーザビリティ向上">😊 ユーザビリティ向上</a></li>
            <li class="toc-h3"><a href="#️-セキュリティ強化">🛡️ セキュリティ強化</a></li>
            <li class="toc-h3"><a href="#⚙️-管理コスト削減">⚙️ 管理コスト削減</a></li>
            <li class="toc-h2"><a href="#SPService-ProviderとAWS登録">🛒
                SP（Service Provider）とAWS登録</a></li>
            <li class="toc-h3"><a href="#IdPとSPの関係">IdPとSPの関係</a></li>
            <li class="toc-h3"><a href="#IdP側の設定">📝 IdP側の設定</a></li>
            <li class="toc-h3"><a href="#☁️-AWS側の設定">☁️ AWS側の設定</a></li>
            <li class="toc-h3"><a href="#具体的な登録プロセス">具体的な登録プロセス</a></li>
            <li class="toc-h2"><a href="#全体の流れ">🔄
                全体の流れ</a></li>
            <li class="toc-h3"><a href="#SAMLフェデレーションの完全な流れ">SAMLフェデレーションの完全な流れ</a></li>
            <li class="toc-h2"><a href="#SAMLアサーションとは？">🎫
                SAMLアサーションとは？</a></li>
            <li class="toc-h3"><a href="#SAMLアサーションデジタルチケットの中身">SAMLアサーション（デジタルチケット）の中身</a></li>
            <li class="toc-h3"><a href="#セキュリティ機能">🔐 セキュリティ機能</a></li>
            <li class="toc-h3"><a href="#含まれる情報">📋 含まれる情報</a></li>
            <li class="toc-h3"><a href="#⚡-特徴">⚡ 特徴</a></li>
            <li class="toc-h3"><a href="#SAMLアサーションの流れ">SAMLアサーションの流れ</a></li>
            <li class="toc-h2"><a href="#信頼ポリシー---なぜ必要？">🏨
                信頼ポリシー - なぜ必要？</a></li>
            <li class="toc-h3"><a href="#登場人物の関係">登場人物の関係</a></li>
            <li class="toc-h3"><a href="#❌-信頼ポリシーがない場合">❌ 信頼ポリシーがない場合</a></li>
            <li class="toc-h3"><a href="#✅-信頼ポリシーがある場合">✅ 信頼ポリシーがある場合</a></li>
            <li class="toc-h3"><a href="#セキュリティ">🔒 セキュリティ</a></li>
            <li class="toc-h3"><a href="#明確なルール">📋 明確なルール</a></li>
            <li class="toc-h3"><a href="#⚡-自動判断">⚡ 自動判断</a></li>
            <li class="toc-h2"><a href="#⚙️-実際の信頼ポリシー設定">⚙️
                実際の信頼ポリシー設定</a></li>
            <li class="toc-h3"><a href="#ホテルの受付マニュアル-→-AWS信頼ポリシー">ホテルの受付マニュアル → AWS信頼ポリシー</a></li>
            <li class="toc-h3"><a href="#設定項目の詳細説明">設定項目の詳細説明</a></li>
            <li class="toc-h2"><a href="#✨-まとめ">✨
                まとめ</a></li>
            <li class="toc-h3"><a href="#IAM">🔐 IAM</a></li>
            <li class="toc-h3"><a href="#️-IdP">🏛️ IdP</a></li>
            <li class="toc-h3"><a href="#SAML-2.0">📜 SAML 2.0</a></li>
            <li class="toc-h3"><a href="#フェデレーション">🤝 フェデレーション</a></li>
            <li class="toc-h3"><a href="#SSO">🔑 SSO</a></li>
            <li class="toc-h3"><a href="#結果">🎯 結果</a></li>
        </ul>
    </nav>
</div>

<style>
    #toc-container a {
        color: #1e40af;
        text-decoration: none;
        transition: all 0.2s;
        display: block;
        padding: 8px 12px;
        border-radius: 6px;
        margin: 4px 0;
    }

    #toc-container a:hover {
        background: rgba(59, 130, 246, 0.1);
        color: #2563eb;
        transform: translateX(5px);
    }

    #toc-container .toc-h2 {
        font-weight: 600;
        font-size: 1.05em;
        margin-top: 10px;
    }

    #toc-container .toc-h3 {
        font-size: 0.95em;
        padding-left: 30px;
        color: #4b5563;
    }

    #toc-content.collapsed {
        max-height: 0;
        overflow: hidden;
        opacity: 0;
    }

    html {
        scroll-behavior: smooth;
    }

    @media (max-width: 768px) {
        #toc-container {
            padding: 15px;
        }

        #toc-container h2 {
            font-size: 1.1em;
        }
    }
</style>

<script>
    function toggleTOC() {
        const content = document.getElementById('toc-content');
        const icon = document.getElementById('toc-toggle-icon');
        const text = document.getElementById('toc-toggle-text');

        if (content.classList.contains('collapsed')) {
            content.classList.remove('collapsed');
            icon.textContent = '▼';
            text.textContent = '折りたたむ';
        } else {
            content.classList.add('collapsed');
            icon.textContent = '▶';
            text.textContent = '展開する';
        }
    }

    // ページロード時に目次の高さを設定
    document.addEventListener('DOMContentLoaded', function() {
        const tocContent = document.getElementById('toc-content');
        if (tocContent) {
            tocContent.style.maxHeight = tocContent.scrollHeight + 'px';
        }
    });
</script>


            <p>IdP・SAML2.0・SSOを使ったシングルサインオンをやさしく解説</p>
        </div>

        <div class="section">
            <h2 id="IAMとは？" class="section-title">
                <div class="icon" style="background: #3498db;">🏢</div>
                IAMとは？
            </h2>
            
            <div class="analogy-box">
                <div class="analogy-title">
                    🏠 たとえ話：会社のセキュリティシステム
                </div>
                <p><strong>IAM（Identity and Access Management）</strong>は、会社の入退室管理システムのようなものです。</p>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li>👤 <strong>誰が</strong>（Identity：身元確認）</li>
                    <li>🚪 <strong>どこに入れるか</strong>（Access：アクセス権限）</li>
                    <li>⚙️ <strong>何ができるか</strong>（Management：管理）</li>
                </ul>
            </div>

            <div class="key-points">
                <div class="key-point">
                    <h3 id="身元確認">🔍 身元確認</h3>
                    <p>ユーザーが本当に本人かどうかを確認</p>
                </div>
                <div class="key-point">
                    <h3 id="️-アクセス制御">🛡️ アクセス制御</h3>
                    <p>適切な権限を持つ人だけがリソースにアクセス可能</p>
                </div>
                <div class="key-point">
                    <h3 id="一元管理">📊 一元管理</h3>
                    <p>すべてのユーザーと権限を中央で管理</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 id="️-IdPIdentity-Providerとは？" class="section-title">
                <div class="icon" style="background: #e17055;">🏛️</div>
                IdP（Identity Provider）とは？
            </h2>
            
            <div class="analogy-box">
                <div class="analogy-title">
                    🆔 たとえ話：身分証明書の発行機関
                </div>
                <p><strong>IdP</strong>は、運転免許証を発行する警察署や、学生証を発行する大学のような<span class="highlight">信頼できる身元証明機関</span>です。</p>
            </div>

            <div class="diagram">
                <div class="entity company">🏛️ 会社のIdP<br>（Active Directory等）</div>
                <div class="arrow"></div>
                <div class="entity user">👤 従業員</div>
                <div class="arrow"></div>
                <div class="entity aws">☁️ AWS</div>
                <p style="margin-top: 20px;"><strong>IdPが身元を証明 → ユーザーがAWSにアクセス</strong></p>
            </div>

            <div class="key-points">
                <div class="key-point">
                    <h3 id="認証の専門家">🔐 認証の専門家</h3>
                    <p>ユーザーのパスワードやMFAを管理</p>
                </div>
                <div class="key-point">
                    <h3 id="信頼関係">🤝 信頼関係</h3>
                    <p>AWSがIdPを信頼してユーザーを受け入れ</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 id="SAML-2.0とは？" class="section-title">
                <div class="icon" style="background: #00b894;">📜</div>
                SAML 2.0とは？
            </h2>
            
            <div class="analogy-box">
                <div class="analogy-title">
                    📋 たとえ話：標準化された身分証明書のフォーマット
                </div>
                <p><strong>SAML 2.0</strong>は、身分証明書の<span class="highlight">国際標準フォーマット</span>のようなものです。どこの国でも読める共通の形式です。</p>
            </div>

            <div class="diagram">
                <h3 id="SAMLトークンの中身">SAMLトークンの中身</h3>
                <div style="background: white; border-radius: 10px; padding: 20px; margin: 20px 0; border: 2px dashed #00b894;">
                    <p>📝 <strong>ユーザー情報：</strong>田中太郎</p>
                    <p>🏢 <strong>所属：</strong>ABC株式会社</p>
                    <p>📧 <strong>メール：</strong>tanaka@abc.com</p>
                    <p>👥 <strong>グループ：</strong>開発部</p>
                    <p>⏰ <strong>有効期限：</strong>1時間</p>
                    <p>🔏 <strong>電子署名：</strong>IdPによる改ざん防止</p>
                </div>
            </div>

            <div class="key-points">
                <div class="key-point">
                    <h3 id="標準プロトコル">🌐 標準プロトコル</h3>
                    <p>異なるシステム間でも共通理解</p>
                </div>
                <div class="key-point">
                    <h3 id="セキュア">🔒 セキュア</h3>
                    <p>暗号化と電子署名で保護</p>
                </div>
                <div class="key-point">
                    <h3 id="⚡-効率的">⚡ 効率的</h3>
                    <p>一度認証すれば複数サービスで利用可能</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 id="フェデレーションとは？" class="section-title">
                <div class="icon" style="background: #fdcb6e;">🔗</div>
                フェデレーションとは？
            </h2>
            
            <div class="analogy-box">
                <div class="analogy-title">
                    🤝 たとえ話：提携関係
                </div>
                <p><strong>フェデレーション</strong>は、大学間の単位互換制度のような<span class="highlight">組織間の信頼関係</span>です。A大学の学生証でB大学の図書館も使えるイメージです。</p>
            </div>

            <div class="big-diagram">
                <h3 id="フェデレーションの仕組み">フェデレーションの仕組み</h3>
                <svg width="100%" height="300" style="margin: 20px 0;">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" 
                                refX="10" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#2d3436"/>
                        </marker>
                    </defs>
                    
                    <!-- 会社IdP -->
                    <rect x="50" y="50" width="150" height="80" rx="10" fill="#fd79a8"/>
                    <text x="125" y="80" text-anchor="middle" fill="white" font-weight="bold">🏛️ 会社IdP</text>
                    <text x="125" y="100" text-anchor="middle" fill="white">Active Directory</text>
                    
                    <!-- AWS -->
                    <rect x="350" y="50" width="150" height="80" rx="10" fill="#55efc4"/>
                    <text x="425" y="80" text-anchor="middle" fill="white" font-weight="bold">☁️ AWS</text>
                    <text x="425" y="100" text-anchor="middle" fill="white">クラウドサービス</text>
                    
                    <!-- ユーザー -->
                    <rect x="200" y="180" width="150" height="80" rx="10" fill="#74b9ff"/>
                    <text x="275" y="210" text-anchor="middle" fill="white" font-weight="bold">👤 ユーザー</text>
                    <text x="275" y="230" text-anchor="middle" fill="white">従業員</text>
                    
                    <!-- 矢印と説明 -->
                    <line x1="200" y1="90" x2="350" y2="90" class="connection"/>
                    <text x="275" y="85" text-anchor="middle" font-size="12" fill="#2d3436">信頼関係</text>
                    
                    <line x1="200" y1="200" x2="180" y2="130" class="connection"/>
                    <text x="170" y="165" text-anchor="middle" font-size="12" fill="#2d3436">認証</text>
                    
                    <line x1="320" y1="200" x2="380" y2="130" class="connection"/>
                    <text x="370" y="165" text-anchor="middle" font-size="12" fill="#2d3436">アクセス</text>
                </svg>
            </div>
        </div>

        <div class="section">
            <h2 id="SSOシングルサインオンとは？" class="section-title">
                <div class="icon" style="background: #a29bfe;">🔑</div>
                SSO（シングルサインオン）とは？
            </h2>
            
            <div class="analogy-box">
                <div class="analogy-title">
                    🗝️ たとえ話：マスターキー
                </div>
                <p><strong>SSO</strong>は、ホテルのマスターキーのようなもので、<span class="highlight">一度ログインすれば複数のサービス</span>にアクセスできます。</p>
            </div>

            <div class="diagram">
                <h3 id="SSO-の利点">SSO の利点</h3>
                <div class="flow-step user pulse">
                    <strong>1回のログイン</strong><br>
                    会社のIDでログイン
                </div>
                <div class="arrow"></div>
                <div class="flow-step aws">
                    <strong>複数サービス利用</strong><br>
                    AWS・Office365・Slack等
                </div>
            </div>

            <div class="key-points">
                <div class="key-point">
                    <h3 id="ユーザビリティ向上">😊 ユーザビリティ向上</h3>
                    <p>パスワードを覚える負担軽減</p>
                </div>
                <div class="key-point">
                    <h3 id="️-セキュリティ強化">🛡️ セキュリティ強化</h3>
                    <p>パスワード使い回しのリスク削減</p>
                </div>
                <div class="key-point">
                    <h3 id="⚙️-管理コスト削減">⚙️ 管理コスト削減</h3>
                    <p>IT部門の管理負担軽減</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 id="SPService-ProviderとAWS登録" class="section-title">
                <div class="icon" style="background: #6c5ce7;">🛒</div>
                SP（Service Provider）とAWS登録
            </h2>
            
            <div class="analogy-box">
                <div class="analogy-title">
                    🏪 たとえ話：提携店舗への登録
                </div>
                <p><strong>SP（Service Provider）</strong>は、クレジットカード会社（IdP）と提携する<span class="highlight">お店</span>のようなものです。AWSを「お店」として登録することで、従業員が「会社カード」でサービスを利用できます。</p>
            </div>

            <div class="big-diagram">
                <h3 id="IdPとSPの関係">IdPとSPの関係</h3>
                <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 20px;">
                    <div style="text-align: center;">
                        <div class="entity company" style="margin: 10px;">
                            🏛️ IdP<br>
                            <small>Identity Provider</small><br>
                            <small>認証の専門家</small>
                        </div>
                        <p style="margin-top: 10px; font-weight: bold;">会社のActive Directory</p>
                    </div>
                    
                    <div style="text-align: center; flex: 1; min-width: 200px;">
                        <div style="font-size: 2em; color: #2d3436;">⚡</div>
                        <p style="margin: 10px 0; font-weight: bold; color: #d63031;">信頼関係構築</p>
                        <p style="font-size: 0.9em; color: #636e72;">SPとして登録</p>
                    </div>
                    
                    <div style="text-align: center;">
                        <div class="entity aws" style="margin: 10px;">
                            ☁️ SP<br>
                            <small>Service Provider</small><br>
                            <small>サービス提供者</small>
                        </div>
                        <p style="margin-top: 10px; font-weight: bold;">AWS・Office365・Slack</p>
                    </div>
                </div>
            </div>

            <div class="key-points">
                <div class="key-point">
                    <h3 id="IdP側の設定">📝 IdP側の設定</h3>
                    <p>• SP識別子（Entity ID）<br>• アクセス先URL（ACS URL）<br>• 属性マッピング設定</p>
                </div>
                <div class="key-point">
                    <h3 id="☁️-AWS側の設定">☁️ AWS側の設定</h3>
                    <p>• SAMLプロバイダー作成<br>• IAMロール設定<br>• 信頼関係の構築</p>
                </div>
            </div>

            <div class="diagram">
                <h3 id="具体的な登録プロセス">具体的な登録プロセス</h3>
                <div style="background: white; border-radius: 15px; padding: 25px; margin: 20px 0;">
                    <div class="flow-step company" style="display: block; margin: 10px auto;">
                        <span class="step-number">1</span>
                        <strong>IdP管理者</strong><br>
                        「AWSを信頼できるサービスとして登録」
                    </div>
                    <div style="text-align: center; margin: 15px 0;">📋 設定項目</div>
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin: 15px 0; text-align: left;">
                        <p><strong>• Entity ID:</strong> <code>urn:amazon:webservices</code></p>
                        <p><strong>• ACS URL:</strong> <code>https://signin.aws.amazon.com/saml</code></p>
                        <p><strong>• 属性マッピング:</strong> 部署 → IAMロール</p>
                    </div>
                    
                    <div class="flow-step aws" style="display: block; margin: 10px auto;">
                        <span class="step-number">2</span>
                        <strong>AWS管理者</strong><br>
                        「会社IdPを信頼できる認証機関として登録」
                    </div>
                    <div style="text-align: center; margin: 15px 0;">⚙️ 設定項目</div>
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 15px; margin: 15px 0; text-align: left;">
                        <p><strong>• SAMLプロバイダー:</strong> CompanyAD</p>
                        <p><strong>• メタデータ:</strong> IdPの設定情報（XMLファイル）</p>
                        <p><strong>• IAMロール:</strong> SAML-DeveloperRole</p>
                    </div>
                </div>
            </div>

            <div class="analogy-box" style="background: linear-gradient(135deg, #d1f2eb 0%, #a3e4d7 100%);">
                <div class="analogy-title" style="color: #27ae60;">
                    🎯 登録完了後の状態
                </div>
                <p>
                    <strong>登録前:</strong> 従業員はAWS専用のパスワードが必要<br>
                    <strong>登録後:</strong> 会社のIDとパスワードだけでAWSにアクセス可能！<br>
                    <span style="font-size: 0.9em; opacity: 0.8;">部署に応じて自動的に適切な権限が割り当てられます</span>
                </p>
            </div>
        </div>

        <div class="section">
            <h2 id="全体の流れ" class="section-title">
                <div class="icon" style="background: #e84393;">🔄</div>
                全体の流れ
            </h2>
            
            <div class="analogy-box">
                <div class="analogy-title">
                    🎭 たとえ話：劇場への入場
                </div>
                <p>会社のIDカードで劇場（AWS）に入る流れを想像してください。</p>
            </div>

            <div class="big-diagram">
                <h3 id="SAMLフェデレーションの完全な流れ">SAMLフェデレーションの完全な流れ</h3>
                
                <div style="margin: 30px 0;">
                    <div class="flow-step user">
                        <span class="step-number">1</span>
                        <strong>ユーザー</strong><br>
                        AWSにアクセス要求
                    </div>
                    <div class="arrow"></div>
                    <div class="flow-step aws">
                        <span class="step-number">2</span>
                        <strong>AWS</strong><br>
                        IdPにリダイレクト
                    </div>
                </div>

                <div style="margin: 30px 0;">
                    <div class="flow-step idp">
                        <span class="step-number">3</span>
                        <strong>IdP</strong><br>
                        ユーザー認証
                    </div>
                    <div class="arrow"></div>
                    <div class="flow-step idp">
                        <span class="step-number">4</span>
                        <strong>IdP</strong><br>
                        SAMLトークン発行
                    </div>
                </div>

                <div style="margin: 30px 0;">
                    <div class="flow-step user">
                        <span class="step-number">5</span>
                        <strong>ユーザー</strong><br>
                        トークンをAWSに提示
                    </div>
                    <div class="arrow"></div>
                    <div class="flow-step aws">
                        <span class="step-number">6</span>
                        <strong>AWS</strong><br>
                        アクセス許可！
                    </div>
                </div>
            </div>

            <div class="analogy-box">
                <div class="analogy-title">
                    🎯 実際の例
                </div>
                <p>
                    <strong>1.</strong> 田中さんがAWSコンソールにアクセス<br>
                    <strong>2.</strong> AWSが「会社のIdPで認証してください」と案内<br>
                    <strong>3.</strong> 田中さんが会社のパスワードでログイン<br>
                    <strong>4.</strong> IdPが「田中さんは開発部の正社員です」という証明書（SAMLトークン）を発行<br>
                    <strong>5.</strong> 田中さんがその証明書をAWSに提示<br>
                    <strong>6.</strong> AWSが証明書を確認して、開発部用の権限でアクセス許可
                </p>
            </div>
        </div>

        <div class="section">
            <h2 id="SAMLアサーションとは？" class="section-title">
                <div class="icon" style="background: #fd79a8;">🎫</div>
                SAMLアサーションとは？
            </h2>
            
            <div class="analogy-box">
                <div class="analogy-title">
                    🎫 たとえ話：コンサートの入場チケット
                </div>
                <p><strong>SAMLアサーション</strong>は、コンサートの<span class="highlight">入場チケット</span>のようなもので、ユーザーの身元と権限を証明する「デジタル身分証明書」です。</p>
            </div>

            <div class="big-diagram">
                <h3 id="SAMLアサーションデジタルチケットの中身">SAMLアサーション（デジタルチケット）の中身</h3>
                <div style="background: white; border: 3px dashed #fd79a8; border-radius: 15px; padding: 25px; margin: 20px 0; position: relative;">
                    <div style="position: absolute; top: -15px; left: 20px; background: #fd79a8; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold;">🎫 SAMLアサーション</div>
                    <div style="margin-top: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <h4 style="color: #2d3436; margin-bottom: 10px;">👤 認証情報</h4>
                                <p><strong>ユーザー：</strong>田中太郎</p>
                                <p><strong>認証時刻：</strong>2025-06-06 14:30</p>
                                <p><strong>認証方法：</strong>パスワード + MFA</p>
                            </div>
                            <div>
                                <h4 style="color: #2d3436; margin-bottom: 10px;">🏢 属性情報</h4>
                                <p><strong>メール：</strong>tanaka@company.com</p>
                                <p><strong>部署：</strong>開発部</p>
                                <p><strong>グループ：</strong>Developers</p>
                            </div>
                        </div>
                        <div style="border-top: 2px dashed #ddd; padding-top: 15px;">
                            <h4 style="color: #2d3436; margin-bottom: 10px;">🔑 認可情報</h4>
                            <p><strong>AWSロール：</strong>arn:aws:iam::123456789:role/DeveloperRole</p>
                            <p><strong>有効期限：</strong>1時間</p>
                            <p><strong>発行者：</strong>会社IdP（電子署名付き）</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="key-points">
                <div class="key-point">
                    <h3 id="セキュリティ機能">🔐 セキュリティ機能</h3>
                    <p>• <strong>デジタル署名</strong>：改ざん検出<br>• <strong>暗号化</strong>：情報保護<br>• <strong>有効期限</strong>：リスク最小化</p>
                </div>
                <div class="key-point">
                    <h3 id="含まれる情報">📋 含まれる情報</h3>
                    <p>• <strong>認証情報</strong>：誰が、いつ、どうやって<br>• <strong>属性情報</strong>：ユーザーの詳細<br>• <strong>認可情報</strong>：アクセス権限</p>
                </div>
                <div class="key-point">
                    <h3 id="⚡-特徴">⚡ 特徴</h3>
                    <p>• <strong>一時的</strong>：短時間で失効<br>• <strong>標準化</strong>：SAML 2.0準拠<br>• <strong>信頼性</strong>：IdPの保証付き</p>
                </div>
            </div>

            <div class="diagram">
                <h3 id="SAMLアサーションの流れ">SAMLアサーションの流れ</h3>
                <div style="margin: 20px 0;">
                    <div class="flow-step idp">
                        <span class="step-number">1</span>
                        <strong>IdP</strong><br>
                        「田中さんは本物の従業員です！」
                    </div>
                    <div class="arrow"></div>
                    <div class="flow-step idp">
                        <span class="step-number">2</span>
                        <strong>SAMLアサーション生成</strong><br>
                        デジタル署名付きXML文書
                    </div>
                </div>
                
                <div style="margin: 20px 0;">
                    <div class="flow-step user">
                        <span class="step-number">3</span>
                        <strong>ユーザー</strong><br>
                        アサーションをAWSに提示
                    </div>
                    <div class="arrow"></div>
                    <div class="flow-step aws">
                        <span class="step-number">4</span>
                        <strong>AWS</strong><br>
                        署名検証 → アクセス許可
                    </div>
                </div>
            </div>

            <div class="analogy-box" style="background: linear-gradient(135deg, #fff2e6 0%, #ffe0b3 100%);">
                <div class="analogy-title" style="color: #d68910;">
                    💡 重要なポイント
                </div>
                <p>
                    SAMLアサーションは<strong>「使い捨てのデジタルチケット」</strong>です。<br>
                    一度使用すると短時間で無効になり、毎回新しいものが発行されるため、<br>
                    セキュリティが高く保たれています。
                </p>
            </div>
        </div>

        <div class="section">
            <h2 id="信頼ポリシー---なぜ必要？" class="section-title">
                <div class="icon" style="background: #d63031;">🏨</div>
                信頼ポリシー - なぜ必要？
            </h2>
            
            <div class="analogy-box">
                <div class="analogy-title">
                    🏨 たとえ話：高級ホテルのVIPルーム
                </div>
                <p><strong>信頼ポリシー</strong>は、高級ホテルが作る<span class="highlight">「信頼できる旅行代理店リスト」</span>のようなものです。事前に「どの代理店からの予約なら受け入れるか」を決めておきます。</p>
            </div>

            <div class="big-diagram">
                <h3 id="登場人物の関係">登場人物の関係</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 25px 0;">
                    <div style="text-align: center;">
                        <div class="entity aws" style="margin: 10px auto;">
                            🏨 高級ホテル<br>
                            <small>（AWS）</small>
                        </div>
                        <p style="margin-top: 10px; font-size: 0.9em;">VIPルームを管理</p>
                    </div>
                    
                    <div style="text-align: center;">
                        <div class="entity company" style="margin: 10px auto;">
                            🏢 旅行代理店<br>
                            <small>（SAMLプロバイダー）</small>
                        </div>
                        <p style="margin-top: 10px; font-size: 0.9em;">予約を取り扱う</p>
                    </div>
                    
                    <div style="text-align: center;">
                        <div class="entity user" style="margin: 10px auto;">
                            👤 お客様<br>
                            <small>（ユーザー）</small>
                        </div>
                        <p style="margin-top: 10px; font-size: 0.9em;">VIPルームを利用したい</p>
                    </div>
                    
                    <div style="text-align: center;">
                        <div style="background: linear-gradient(135deg, #fdcb6e, #e17055); color: white; padding: 20px; border-radius: 15px; margin: 10px auto; min-width: 150px;">
                            📋 信頼リスト<br>
                            <small>（信頼ポリシー）</small>
                        </div>
                        <p style="margin-top: 10px; font-size: 0.9em;">受付マニュアル</p>
                    </div>
                </div>
            </div>

            <div class="diagram">
                <h3 id="❌-信頼ポリシーがない場合">❌ 信頼ポリシーがない場合</h3>
                <div style="background: #ffe6e6; border: 2px solid #d63031; border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <div class="flow-step user" style="margin: 10px;">
                        👤 田中さん<br>
                        「VIPルーム予約の田中です！」
                    </div>
                    <div class="arrow"></div>
                    <div class="flow-step aws" style="margin: 10px;">
                        🏨 ホテル<br>
                        「どちらの代理店？聞いたことないですね...🤔」
                    </div>
                    <div style="text-align: center; margin: 15px 0; font-weight: bold; color: #d63031;">
                        ❌ お断り！セキュリティリスク！
                    </div>
                </div>
            </div>

            <div class="diagram">
                <h3 id="✅-信頼ポリシーがある場合">✅ 信頼ポリシーがある場合</h3>
                <div style="background: #e6ffe6; border: 2px solid #27ae60; border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <div style="background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                        <h4 style="color: #27ae60; margin-bottom: 10px;">📋 事前作成：信頼できる代理店リスト</h4>
                        <p>✅ <strong>ABC株式会社旅行部</strong>（SAMLプロバイダー）</p>
                        <p>✅ <strong>XYZ旅行代理店</strong></p>
                        <p>❌ 怪しい代理店X（登録なし）</p>
                    </div>
                    
                    <div class="flow-step user" style="margin: 10px;">
                        👤 田中さん<br>
                        「ABC株式会社で予約した田中です！」
                    </div>
                    <div class="arrow"></div>
                    <div class="flow-step aws" style="margin: 10px;">
                        🏨 ホテル<br>
                        「ABC株式会社は信頼リストにありますね！✅」
                    </div>
                    <div style="text-align: center; margin: 15px 0; font-weight: bold; color: #27ae60;">
                        ✅ VIPルームへご案内！
                    </div>
                </div>
            </div>

            <div class="key-points">
                <div class="key-point">
                    <h3 id="セキュリティ">🔒 セキュリティ</h3>
                    <p>知らない代理店（IdP）からの予約（SAMLアサーション）は受け入れない</p>
                </div>
                <div class="key-point">
                    <h3 id="明確なルール">📋 明確なルール</h3>
                    <p>事前に「誰を信頼するか」を決めておく受付マニュアル</p>
                </div>
                <div class="key-point">
                    <h3 id="⚡-自動判断">⚡ 自動判断</h3>
                    <p>リストにあれば自動でOK、なければ自動でNG</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 id="⚙️-実際の信頼ポリシー設定" class="section-title">
                <div class="icon" style="background: #74b9ff;">⚙️</div>
                実際の信頼ポリシー設定
            </h2>
            
            <div class="analogy-box">
                <div class="analogy-title">
                    📝 たとえ話：ホテルの受付マニュアル
                </div>
                <p>実際のAWS信頼ポリシーは、<span class="highlight">ホテルの詳細な受付マニュアル</span>のようなものです。</p>
            </div>

            <div class="big-diagram">
                <h3 id="ホテルの受付マニュアル-→-AWS信頼ポリシー">ホテルの受付マニュアル → AWS信頼ポリシー</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 25px 0;">
                    
                    <!-- ホテル版 -->
                    <div style="background: #fff3cd; border-radius: 15px; padding: 20px;">
                        <h4 style="color: #856404; margin-bottom: 15px;">🏨 ホテル受付マニュアル</h4>
                        <div style="background: white; border-radius: 10px; padding: 15px; font-size: 0.9em;">
                            <p><strong>📋 信頼する代理店:</strong><br>ABC株式会社旅行部のみ</p>
                            <hr style="margin: 10px 0; border: 1px dashed #ddd;">
                            <p><strong>✅ 受け入れ条件:</strong><br>• 正式な予約確認書を持参<br>• 開発部の社員のみ<br>• 平日営業時間内</p>
                            <hr style="margin: 10px 0; border: 1px dashed #ddd;">
                            <p><strong>🚫 禁止事項:</strong><br>• リストにない代理店はNG<br>• 確認書なしはNG</p>
                        </div>
                    </div>

                    <!-- AWS版 -->
                    <div style="background: #d1f2eb; border-radius: 15px; padding: 20px;">
                        <h4 style="color: #0e6b3d; margin-bottom: 15px;">☁️ AWS信頼ポリシー</h4>
                        <div style="background: white; border-radius: 10px; padding: 15px; font-size: 0.8em; font-family: monospace;">
<pre style="margin: 0; white-space: pre-wrap;">
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Allow",
    "Principal": {
      "SAML": "arn:aws:iam::123:saml-provider/ABC"
    },
    "Action": "sts:AssumeRoleWithSAML",
    "Condition": {
      "StringEquals": {
        "SAML:Department": "開発部"
      }
    }
  }]
}
</pre>
                        </div>
                    </div>
                </div>
            </div>

            <div class="diagram">
                <h3 id="設定項目の詳細説明">設定項目の詳細説明</h3>
                <div style="background: white; border-radius: 15px; padding: 25px; margin: 20px 0;">
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px dashed #ddd;">
                        <div style="background: #74b9ff; color: white; padding: 15px; border-radius: 10px; text-align: center; font-weight: bold;">
                            Principal<br>
                            <small>（信頼する相手）</small>
                        </div>
                        <div>
                            <p><strong>SAML:</strong> 「この特定のSAMLプロバイダーを信頼します」</p>
                            <p><code>arn:aws:iam::123:saml-provider/ABC</code></p>
                            <p style="color: #636e72; font-size: 0.9em;">→ ABC会社のIdPからの認証のみ受け入れ</p>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px dashed #ddd;">
                        <div style="background: #fd79a8; color: white; padding: 15px; border-radius: 10px; text-align: center; font-weight: bold;">
                            Action<br>
                            <small>（許可する操作）</small>
                        </div>
                        <div>
                            <p><strong>sts:AssumeRoleWithSAML</strong></p>
                            <p style="color: #636e72; font-size: 0.9em;">→ SAMLアサーションを使ってロールを引き受ける操作を許可</p>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; align-items: center;">
                        <div style="background: #55efc4; color: white; padding: 15px; border-radius: 10px; text-align: center; font-weight: bold;">
                            Condition<br>
                            <small>（追加条件）</small>
                        </div>
                        <div>
                            <p><strong>SAML:Department = "開発部"</strong></p>
                            <p style="color: #636e72; font-size: 0.9em;">→ SAMLアサーションに「開発部」の属性がある場合のみ許可</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="analogy-box" style="background: linear-gradient(135deg, #ffeedd 0%, #ffcc99 100%);">
                <div class="analogy-title" style="color: #d68910;">
                    🎯 実際の動作例
                </div>
                <p>
                    <strong>1.</strong> 田中さん（開発部）がAWSにアクセス<br>
                    <strong>2.</strong> AWSが信頼ポリシーをチェック<br>
                    <strong>3.</strong> 「ABC会社のIdP？✅」「開発部？✅」「OK！」<br>
                    <strong>4.</strong> 山田さん（総務部）の場合は「総務部？❌」でNG
                </p>
            </div>
        </div>

        <div class="section">
            <h2 id="✨-まとめ" class="section-title">
                <div class="icon" style="background: #00cec9;">✨</div>
                まとめ
            </h2>

            <div class="key-points">
                <div class="key-point">
                    <h3 id="IAM">🔐 IAM</h3>
                    <p>AWSの<strong>セキュリティの門番</strong><br>誰が何にアクセスできるかを管理</p>
                </div>
                <div class="key-point">
                    <h3 id="️-IdP">🏛️ IdP</h3>
                    <p><strong>信頼できる身元証明機関</strong><br>ユーザーの認証を担当</p>
                </div>
                <div class="key-point">
                    <h3 id="SAML-2.0">📜 SAML 2.0</h3>
                    <p><strong>共通の身分証明書フォーマット</strong><br>異なるシステム間の橋渡し</p>
                </div>
                <div class="key-point">
                    <h3 id="フェデレーション">🤝 フェデレーション</h3>
                    <p><strong>組織間の信頼関係</strong><br>外部IdPとAWSの連携</p>
                </div>
                <div class="key-point">
                    <h3 id="SSO">🔑 SSO</h3>
                    <p><strong>一度のログインで全てアクセス</strong><br>利便性とセキュリティを両立</p>
                </div>
                <div class="key-point">
                    <h3 id="結果">🎯 結果</h3>
                    <p><strong>効率的で安全なアクセス管理</strong><br>ユーザーも管理者もハッピー</p>
                </div>
            </div>

            <div class="analogy-box" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); text-align: center;">
                <div class="analogy-title" style="justify-content: center;">
                    🎉 最終的に実現されること
                </div>
                <p style="font-size: 1.2em; line-height: 1.8;">
                    <strong>会社のIDひとつで、AWS・Office365・Slackなど</strong><br>
                    <strong>すべてのクラウドサービスが使える！</strong><br>
                    <span style="font-size: 0.9em; opacity: 0.8;">パスワード管理の煩わしさから解放され、セキュリティも向上</span>
                </p>
            </div>
        </div>
    </div>

    <div style="text-align: center; padding: 20px; margin-top: 40px; border-top: 2px solid #E5E7EB; background-color: #F9FAFB;">
        <p style="color: #6B7280; font-size: 0.9em; margin: 0;">
            Created by <a href="https://github.com/SSuzuki1063" target="_blank" style="color: #FF9900; text-decoration: none; font-weight: 600;">SSuzuki1063</a>
        </p>
        <p style="color: #9CA3AF; font-size: 0.8em; margin: 5px 0 0 0;">
            AWS SAP Learning Resources
        </p>
    </div>

</body>
</html>